---
title: REST API(6) Event ìƒì„± API êµ¬í˜„ - ì—¬ëŸ¬ Bad Request ì²˜ë¦¬í•˜ê¸°
date: 2024-02-23 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## êµ¬í˜„ Package ë° Class  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/965cb771-b0ae-4ec3-97a9-909e7d6254ab)  
  
---  
## ì…ë ¥ ê°’ì´ ì—†ì„ ë•Œ, Bad Request ì²˜ë¦¬í•˜ê¸°  
ìš”ì²­ ì…ë ¥ê°’ì´ ì—†ì„ ë•Œì— ëŒ€í•œ Bad Requestë¥¼ ì²˜ë¦¬í•˜ê² ë‹¤.  

### EventControllerTests 
```java
// import ìƒëµ

@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ  

    @Test
    public void createEvent_Bad_Request_Empty_Input() throws Exception {
        EventDto eventDto = EventDto.builder().build();

        this.mockMvc.perform(post("/api/events")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .content(this.objectMapper.writeValueAsString(eventDto))
                        )
                .andExpect(status().isBadRequest());
    }
}

```  
* ìœ„ì™€ ê°™ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ì¤€ë‹¤.  
* **`EventDto`**ì— ëŒ€í•œ ê°ì²´ë¥¼ Builder Patternìœ¼ë¡œ ì…ë ¥ê°’ì„ ì•„ë¬´ê²ƒë„ ë„£ì–´ì£¼ì§€ ì•Šì€ì±„ë¡œ ìƒì„±í•œë‹¤.  
* ì´ ì…ë ¥ê°’ì´ ì—†ëŠ” ê°ì²´ë¥¼ ë„˜ê²¨ì£¼ê³  Bad Request ì‘ë‹µì´ ë‚˜ì˜¤ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³¸ë‹¤. í•˜ì§€ë§Œ...  
  
---  
### ê²°ê³¼ (ì‹¤íŒ¨)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/9c0b9fd2-bc14-4b8f-8e15-da09c73319fe)  
* **`Bad Requset(400)`**ë¥¼ ê¸°ëŒ€í–ˆì§€ë§Œ **ì„±ê³µ** **`201`**ì‘ë‹µì´ ë‚˜ì™€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  
* ì´ìœ ëŠ” ìš°ë¦¬ê°€ ì…ë ¥ê°’ì´ ì—†ì„ ë•Œì— ëŒ€í•œ ì…ë ¥ê°’ì˜ **ê²€ì¦(Validation)** ê³¼ ê²€ì¦ ê²°ê³¼ ë°œìƒí•œ **Error**ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ì•ˆí–ˆê¸° ë•Œë¬¸ì´ë‹¤.  
  
---  
### ì˜¤ë¥˜ ìˆ˜ì •  
ê·¸ëŸ¬ë©´ ì´ì œ ì…ë ¥ê°’ì´ ì£¼ì–´ì¡Œì„ ë•Œ, ê·¸ ì…ë ¥ì„ ê²€ì¦í•˜ê³ , ê²€ì¦ì‹œì— ì—ëŸ¬(ì…ë ¥ê°’ì´ ì—†ë‹¤)ê°€ ìˆìœ¼ë©´ ê·¸ë¥¼ ì²˜ë¦¬í•´ë³´ì.  
### EventDto  
```java
// import ìƒëµ
import javax.validation.constraints.Min;
import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;

@Data @Builder @NoArgsConstructor @AllArgsConstructor
public class EventDto {
    @NotEmpty // ì¶”ê°€
    private String name;
    @NotEmpty // ì¶”ê°€
    private String description;
    @NotNull // ì¶”ê°€
    private LocalDateTime beginEnrollmentDateTime;
    @NotNull // ì¶”ê°€
    private LocalDateTime closeEnrollmentDateTime;
    @NotNull // ì¶”ê°€
    private LocalDateTime beginEventDateTime;
    @NotNull // ì¶”ê°€
    private LocalDateTime endEventDateTime;
    private String location;
    @Min(0) // ì¶”ê°€
    private int basePrice;
    @Min(0) // ì¶”ê°€
    private int maxPrice;
    @Min(0) // ì¶”ê°€
    private int limitOfEnrollment;
}

```  
* ì—”í‹°í‹°(Entity) ê²€ì¦ì— í•„ìš”í•œ ì–´ë…¸í…Œì´ì…˜ì„ ì‘ì„±í•´ì¤€ë‹¤.  
  
---
### EventController  
```java
// import ìƒëµ
import org.springframework.validation.Errors;
import javax.validation.Valid;


@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    public EventController(EventRepository eventRepository, ModelMapper modelMapper){
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){ // ìˆ˜ì •

        if (errors.hasErrors()){ // ì¶”ê°€
            return ResponseEntity.badRequest().build(); 
        }

        Event event = modelMapper.map(eventDto, Event.class);

        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
        return ResponseEntity.created(createdUri).body(newEvent);
    }
}

```
* **`@Valid`** ì–´ë…¸í…Œì´ì…˜ì€ **Requestì— ìˆëŠ” ê°’ë“¤**(ìš”ì²­ê°’ë“¤)ì„ ì—”í‹°í‹°ì— **Binding**í•  ë•Œ **ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.**  
* í•´ë‹¹ ì—”í‹°í‹°ì— ì–´ë…¸í…Œì´ì…˜(**`@NotEmpty`**, **`@NotNull`**, **`@Min(0)`** ... )ì— ëŒ€í•œ ê°’ë“¤ì„ ì°¸ê³ í•´ì„œ ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.   
* ê²€ì¦ì„ ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ **`Errors`**ì˜ ê°ì²´ì— ë‹´ì•„ì¤€ë‹¤.  
* Errorsì˜ ê°ì²´ì¸ **`errors`**ì— ê°’ì´ ìˆìœ¼ë©´, **`Bad Request`**ë¥¼ ë¦¬í„´í•´ì¤€ë‹¤.  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/f92f4985-b56a-4693-962d-7adbd910bf6f)  
  
---  
## ì…ë ¥ê°’ì´ ì´ìƒí•  ë•Œ, Bad Request ì²˜ë¦¬í•˜ê¸°    
ì´ë²ˆì—ëŠ” ì´ìƒí•œ ì…ë ¥ê°’ì´ ë“¤ì–´ì™”ì„ ë•Œ Bad Request ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì´ë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´, **`closeEnrollmentDateTime`**,**`endEventDateTime`**ê°€ ê°ê° **`beginEnrollmentDateTime`**, **`beginEventDateTime`**ë³´ë‹¤ ë¹ ë¥´ë‹¤ë˜ê°€, **`maxPrice`**ê°€ **`basePrice`**ë³´ë‹¤ ì‘ì€ ê²½ìš°ì´ë‹¤.  
  
---  
### EventControllerTests  
```java
// import ìƒëµ


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    @Test
    public void createEvent_Bad_Request_Wrong_Input() throws Exception{
        EventDto eventDto = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,22,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,21,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,20,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,19,14,21))
                .basePrice(10000)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        this.mockMvc.perform(post("/api/events")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .content(this.objectMapper.writeValueAsString(eventDto))
                )
                .andExpect(status().isBadRequest());
        ;
    }
}

```  
  
---  
### ê²°ê³¼ (ì‹¤íŒ¨)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/42aef545-e8a1-4e8f-b4db-0f3fab38ac8b)  
* ì´ ì—­ì‹œ ì´ìƒí•œ ì…ë ¥ê°’ì— ëŒ€í•œ ê²€ì¦ ê³¼ì •ì´ ì—†ê¸° ë•Œë¬¸ì— ì„±ê³µ **`201`**ì´ ì¶œë ¥ëœê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.  
  
---  
### ì˜¤ë¥˜ ìˆ˜ì •  
ë”°ë¼ì„œ, ì…ë ¥ê°’ì„ ê²€ì¦í•´ì£¼ê¸° ìœ„í•œ **`EventValidator`**ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´, ì´ìƒí•œ ì…ë ¥ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë¡œì§ì„ ë§Œë“¤ì–´ ê²€ì¦ì„ ìˆ˜í–‰í•  ê²ƒì´ë‹¤.  
  
---  
### EventValidator  
```java
package me.hantomas.restapi.events;

import org.springframework.stereotype.Component;
import org.springframework.validation.Errors;

import java.time.LocalDateTime;

@Component
public class EventValidator {
    public void validate(EventDto eventDto, Errors errors){
        if (eventDto.getBasePrice() > eventDto.getMaxPrice() && eventDto.getMaxPrice() > 0){
            errors.rejectValue("basePrice","wrongValue","BasePrice is wrong");
            errors.rejectValue("maxPrice","wrongValue","MaxPrice is wrong");
        }


        LocalDateTime endEventDateTime = eventDto.getEndEventDateTime();

        if (endEventDateTime.isBefore(eventDto.getBeginEventDateTime()) ||
        endEventDateTime.isBefore(eventDto.getCloseEnrollmentDateTime()) ||
        endEventDateTime.isBefore(eventDto.getBeginEnrollmentDateTime())) {
            errors.rejectValue("endEventDateTime","wrongValue","endEventDateTime is wring");
        }
    }
}

```  
* **`@Component`**ë¡œ ì´ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•¨ì„ ëª…ì‹œí•œë‹¤.  
* ì…ë ¥ê°’ì— ëŒ€í•œ ì¡°ê±´ì‹ìœ¼ë¡œ **`Validator`**ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤. ê²€ì¦ì‹œ ì—ëŸ¬ëŠ” **`Error`**ì˜ ê°ì²´ì— ë‹´ì•„ì¤€ë‹¤.  
    * `eventDto.getBasePrice() > eventDto.getMaxPrice() && eventDto.getMaxPrice() > 0`ëŠ” basePriceê°€ 100ì´ê³  maxPriceê°€ 0ì¸ ê²½ìš° ë¬´ì œí•œ ê²½ë§¤(ë†’ì€ ê¸ˆì•¡ì„ ë‚¸ ì‚¬ëŒì´ ë“±ë¡)ì´ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ì¡°ê±´ì‹ì„ ì‚¬ìš©í•œë‹¤.  

---  
### EventController ìˆ˜ì •  
```java
// import ìƒëµ

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    private final EventValidator eventValidator; // ì¶”ê°€

    public EventController(EventRepository eventRepository, ModelMapper modelMapper, EventValidator eventValidator) { // ìˆ˜ì •
        this.eventRepository = eventRepository; 
        this.modelMapper = modelMapper;
        this.eventValidator = eventValidator; // ì¶”ê°€
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){

        if (errors.hasErrors()){
            return ResponseEntity.badRequest().build();
        }

        eventValidator.validate(eventDto, errors); // ì¶”ê°€
        if (errors.hasErrors()){ // ì¶”ê°€
            return ResponseEntity.badRequest().build();
        }

        Event event = modelMapper.map(eventDto, Event.class);

        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
        return ResponseEntity.created(createdUri).body(newEvent);
    }
}

```  
* **`@Component`**ë¡œ ë“±ë¡í–ˆë˜ **`EventValidator`**ë¥¼ ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ì£¼ì…í•´ì£¼ê³   
* ì…ë ¥ê°’ ì´ì™¸ì˜ ì…ë ¥ ë˜ëŠ” ì…ë ¥í•˜ì§€ ì•Šì€ ì¦‰, ì—”í‹°í‹°ì˜ ì–´ë…¸í…Œì´ì…˜ì— ìœ„ë°˜í•˜ëŠ” ì…ë ¥ê°’ì´ ìˆëŠ”ì§€ì— ëŒ€í•œ ê²€ì¦ì„ ê±°ì¹œ í›„
* `eventValidator.validate(eventDto, errors);` ë¡œ ì´ìƒí•œ ì…ë ¥ê°’ì— ëŒ€í•œ ê²€ì¦ì„ í•œë²ˆ ë” í•˜ê³ .
* ìˆìœ¼ë©´ **`Bad Request`** ë¦¬í„´  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/15171b6b-79f6-4d43-9361-5c82c9bfe0e3)  

---    
## í…ŒìŠ¤íŠ¸ ì„¤ëª…ìš© ì–´ë…¸í…Œì´ì…˜ ë§Œë“¤ê¸°  
í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œëª…ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì„¤ëª…í•˜ëŠ” ê²ƒìœ¼ë¡œëŠ” ì„¤ëª…í•˜ëŠ”ë° í•œê³„ê°€ ìˆë‹¤.  
í…ŒìŠ¤íŠ¸ ì„¤ëª…ìš© ì–´ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ì–´ ì´ í…ŒìŠ¤íŠ¸ê°€ ì–´ë–¤ í…ŒìŠ¤íŠ¸ì¸ì§€ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.  
  
### TestDespcription @interface ë§Œë“¤ê¸°  
```java
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(ElementType.METHOD)
@Retention(RetentionPolicy.SOURCE)
public @interface TestDescription {
    String value();
}
```  
* **`@Target(ElementType.METHOD)`** : ë§Œë“œëŠ” ì–´ë…¸í…Œì´ì…˜ì˜ íƒ€ê¹ƒì„ ì„¤ì •í•œë‹¤. ì´ ì–´ë…¸í…Œì´ì…˜ì€ ë©”ì†Œë“œì— ì‚¬ìš©í•  ê²ƒì´ë‹¤.  
* **`@Retention(RetentionPolicy.SOURCE)`** : ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì¸ ì½”ë“œë¥¼ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ê°€ì ¸ê°ˆ ê²ƒì¸ì§€ë¥¼ ì˜ë¯¸í•œë‹¤.  
    * `RetentionPolicy.SOURCE`,`RetentionPolicy.CLASS` ,`RetentionPolicy.RUNTIME` ê°€ ìˆë‹¤.  
* `String value();` : ì„¤ëª…ì€ **String**ì´ë‹¤.  

---  
### EventControllerTestsì— ì–´ë…¸í…Œì´ì…˜ ì ìš©í•˜ê¸°  
```java
import me.hantomas.restapi.common.TestDescription; // ì¶”ê°€


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸") // ì¶”ê°€
    public void createEvent() throws Exception{
        // ìƒëµ
    }
    @Test
    @TestDescription("ì…ë ¥ ë°›ì„ ìˆ˜ ì—†ëŠ” ê°’ì„ ì‚¬ìš©í•œ ê²½ìš°ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” í…ŒìŠ¤íŠ¸") // ì¶”ê°€
    public void createEvent_Bad_Request() throws Exception{
        // ìƒëµ
    }
    @Test
    @TestDescription("ì…ë ¥ ê°’ì´ ë¹„ì–´ìˆëŠ” ê²½ìš°ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” í…ŒìŠ¤íŠ¸") // ì¶”ê°€
    public void createEvent_Bad_Request_Empty_Input() throws Exception {
        // ìƒëµ
    }
    @Test
    @TestDescription("ì…ë ¥ê°’ì´ ì˜ëª»ëœ ê²½ìš°ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” í…ŒìŠ¤íŠ¸") // ì¶”ê°€
    public void createEvent_Bad_Request_Wrong_Input() throws Exception{
        // ìƒëµ
    }
}

```  
* ì£¼ì„ì„ ë‹¬ì•„ ì„¤ëª…í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, ì´ëŸ° ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.





