---
title: REST API(11) HATEOAS ì ìš©(2) - ì¸ë±ìŠ¤ ë§Œë“¤ê¸°
date: 2024-03-04 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## API ì¸ë±ìŠ¤ ë§Œë“¤ê¸°  
ìš°ë¦¬ëŠ” ì›¹ì„ ì´ìš©í•  ë•Œ, ì²˜ìŒ ì ‘ê·¼ ì‹œì—ëŠ” Urlë¡œ ì ‘ê·¼í•´ë„ ê·¸ ì´í›„ì˜ í–‰ìœ„ë“¤ì€ ë”°ë¡œ ë˜ Urlì„ ì§ì ‘ ì…ë ¥ í•˜ëŠ” ê²ƒ ì—†ì´, ëª¨ë‘ í´ë¦­ì´ë‚˜, ê°’ì„ ì…ë ¥í•˜ëŠ” ê²ƒì„ í†µí•´ ì¼ì–´ë‚œë‹¤.  
ì´ì™€ ê°™ì´ ìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ë¥¼ ì¡°íšŒ, ìƒì„±, ìˆ˜ì • ë“±ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” APIì˜ **ì§„ì…ì **ì´ í•„ìš”í•˜ë‹¤.  
ì´ë²ˆì—ëŠ” ê·¸ ì§„ì…ì ì— í•´ë‹¹í•˜ëŠ” **ì¸ë±ìŠ¤**ë¥¼ ë§Œë“¤ì–´ ë³´ê² ë‹¤.  
  
### IndexControllerTest  
ë¨¼ì € testì— `index` íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³ , `IndexControllerTest.java` í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.  
```java
package me.hantomas.restapi.index;

import me.hantomas.restapi.common.RestDocsConfiguration;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.annotation.Import;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;


import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class)
@ActiveProfiles("test")
public class IndexControllerTest {

    @Autowired
    MockMvc mockMvc;

    @Test
    public void index() throws Exception {
        this.mockMvc.perform(get("/api/"))
                .do(print())
                .andExpect(status().isOk())
                .andExpect(jsonPath("_links.events").exists());
    }
}

```  
  
---  
### IndexController  
ê·¸ë¦¬ê³  ë˜‘ê°™ì´ `index`íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³  `IndexController.java` í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì´ë²¤íŠ¸ì— ëŒ€í•œ ë§í¬ë¥¼ ì¶”ê°€í•œë‹¤.  
```java
package me.hantomas.restapi.index;

import me.hantomas.restapi.events.EventController;
import org.springframework.hateoas.ResourceSupport;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@RestController
public class IndexController {
    @GetMapping("/api")
    public ResourceSupport index(){
        var index = new ResourceSupport();
        index.add(linkTo(EventController.class).withRel("events"));
        return index;
    }
}

```
* **`EventController`**í´ë˜ìŠ¤ì— ëŒ€í•œ ë§í¬(`@RequestMapping("/api/events")`ì„ í†µí•´ `/api/events"`ë¥¼ ìš”ì²­í•˜ëŠ”)ë¥¼`"events"`ê´€ê³„ë¡œ ë§í¬ë¥¼ ì¶”ê°€í•œë‹¤.<br>ğŸ‘‰"_links":{"events":{"href":"http://localhost:8080/api/events"}}

  
---  
### IndexControllerTest í…ŒìŠ¤íŠ¸ ê²°ê³¼(ì„±ê³µ)
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/56169c7d-a729-41c4-9aa0-b0baa61ded89)
*   

---  
### ErrorResource  
ì¸ë±ìŠ¤ ë§í¬ëŠ” ì…ë ¥ ê°’ì´ ì˜ëª»ë˜ì–´ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°ì— ì¸ë±ìŠ¤ë¡œ ê°€ëŠ” ë§í¬ë¥¼ ì œê³µí•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  
`common`íŒ¨í‚¤ì§€ ì•„ë˜ì—, ì´ë¥¼ ìœ„í•œ `ErrorResource.java`í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ê² ë‹¤.  
```java
package me.hantomas.restapi.common;

import me.hantomas.restapi.index.IndexController;
import org.springframework.hateoas.Link;
import org.springframework.hateoas.Resource;
import org.springframework.validation.Errors;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;
import static org.springframework.hateoas.mvc.ControllerLinkBuilder.methodOn;

public class ErrorsResource extends Resource<Errors> {

    public ErrorsResource(Errors errors, Link... links) {
        super(errors, links);
        add(linkTo(methodOn(IndexController.class).index()).withRel("index"));
    }
}

```  
* ì—ëŸ¬ê°€ ìˆì„ë•Œ `IndexController.class`ì˜ `index()`ë©”ì„œë“œì— ëŒ€í•œ ë§í¬(`"/api"`ë¡œ GET ìš”ì²­ì„ í•˜ëŠ”)ë¥¼ `"index"`ë¼ëŠ” ê´€ê³„ë¡œ ìƒì„±í•œë‹¤.<br> ğŸ‘‰ "_links":{"index":{"href":"http://localhost:8080/api"}}
  
---  
### EventController ìˆ˜ì •  
```java
//import ìƒëµ

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    private final EventValidator eventValidator;

    public EventController(EventRepository eventRepository, ModelMapper modelMapper, EventValidator eventValidator) {
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper;
        this.eventValidator = eventValidator;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){

        if (errors.hasErrors()){
            return badRequest(errors); // ìˆ˜ì •
        }

        eventValidator.validate(eventDto, errors);
        if (errors.hasErrors()){
            return badRequest(errors); // ìˆ˜ì •
        }

        Event event = modelMapper.map(eventDto, Event.class);
        event.update();
        Event newEvent = this.eventRepository.save(event);

        ControllerLinkBuilder selfLinkBuilder = linkTo(EventController.class).slash(newEvent.getId());
        URI createdUri = selfLinkBuilder.toUri();
        EventResource eventResource = new EventResource(newEvent);
        eventResource.add(linkTo(EventController.class).withRel("query-events"));
        eventResource.add(selfLinkBuilder.withRel("update-event"));
        eventResource.add(new Link("/docs/index.html#resources-events-create").withRel("profile"));
        return ResponseEntity.created(createdUri).body(eventResource);
    }

    private  ResponseEntity badRequest(Errors errors){ // ì¶”ê°€
        return ResponseEntity.badRequest().body(new ErrorsResource(errors));
    }
}

```  
* `return ResponseEntity.badRequest().body(new ErrorsResource(errors));` ì—ëŸ¬ ë°œìƒì‹œ ê³µí†µì ìœ¼ë¡œ ì“°ì´ëŠ” ì½”ë“œì´ê¸°ì— ë¦¬íŒ©í† ë§í•´ì¤€ë‹¤.  
  
---  
### EventControllerTests ìˆ˜ì •  
```java
// import ìƒëµ

@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class)
@ActiveProfiles("test")
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì…ë ¥ê°’ì´ ì˜ëª»ëœ ê²½ìš°ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent_Bad_Request_Wrong_Input() throws Exception{
        EventDto eventDto = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,22,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,21,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,20,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,19,14,21))
                .basePrice(10000)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        this.mockMvc.perform(post("/api/events")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .content(this.objectMapper.writeValueAsString(eventDto))
                )
                .andDo(print())
                .andExpect(status().isBadRequest())
                .andExpect(jsonPath("content[0].objectName").exists()) // ìˆ˜ì • $[0] -> content[0]
                .andExpect(jsonPath("content[0].defaultMessage").exists()) // ìˆ˜ì •
                .andExpect(jsonPath("content[0].code").exists()) // ìˆ˜ì •
                .andExpect(jsonPath("_links.index").exists()) // ì¶”ê°€
        ;
    }
}

```  
* `"_links.index"`ê°’ì´ Unwrappedë˜ì§€ ì•Šê³  contentê°’ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ë‹¤ì‹œ ì‘ì„±í•´ì¤€ë‹¤.  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/5ad0d01e-f3b9-47b4-9d82-0c0a310b683a)  
