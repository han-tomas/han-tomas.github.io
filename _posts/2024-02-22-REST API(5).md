---
title: REST API(5) Event ìƒì„± API êµ¬í˜„ - ì…ë ¥ê°’ ì œí•œí•˜ê¸°
date: 2024-02-22 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## êµ¬í˜„ Package ë° Class  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/856df50f-cdfb-406a-8b84-1a3e75d9d43c)  
  
---  
## ì…ë ¥ê°’ ì œí•œí•˜ê¸°  
ìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê¸°ì— ì•ì„œ, **`Id`** ê°’ì€ ìë™ìœ¼ë¡œ ì´ë²¤íŠ¸ ë“±ë¡ì‹œ ìë™ìœ¼ë¡œ ë“±ë¡ì´ ë˜ì•¼í•˜ê³ ,  
**`free`** ë¬´ë£Œì¸ì§€ ì•„ë‹Œì§€ ì—¬ë¶€, **`offline`** ì˜¤í”„ë¼ì¸ì¸ì§€ ì•„ë‹Œì§€ì— ëŒ€í•œ ì—¬ë¶€ ë˜í•œ, ì§ì ‘ ë“±ë¡ì´ ì•„ë‹Œ  
ì…ë ¥ë°›ì€ ë°ì´í„°ë¡œ ê³„ì‚°í•´ì„œ ë“±ë¡ì´ ë˜ì–´ì•¼ í•˜ëŠ” ìš”ì†Œì´ë‹¤.  
ì´ëŸ¬í•œ ì…ë ¥ê°’ì„ ì œí•œí•˜ê¸° ìœ„í•´, ìš°ë¦¬ëŠ” ì…ë ¥ í•´ì•¼í•˜ëŠ” ê°’ë§Œì„ ë‹¤ë£¨ëŠ” **`DTO`**ë¥¼ ë§Œë“¤ ê²ƒì´ë‹¤.  
  
### EventDTO ìƒì„±  
```java
package me.hantomas.restapi.events;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
@Data @Builder @NoArgsConstructor @AllArgsConstructor
public class EventDto {
    private String name;
    private String description;
    private LocalDateTime beginEnrollmentDateTime;
    private LocalDateTime closeEnrollmentDateTime;
    private LocalDateTime beginEventDateTime;
    private LocalDateTime endEventDateTime;
    private String location;
    private int basePrice;
    private int maxPrice;
    private int limitOfEnrollment;
}

```  
* ì—¬ê¸°ì„œëŠ” **`@Data`**ë¥¼ ì‚¬ìš©í•´ì¤˜ë„ ëœë‹¤.  
  
## EventController ìˆ˜ì •  
```java
package me.hantomas.restapi.events;

import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    public EventController(EventRepository eventRepository){
        this.eventRepository = eventRepository;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody EventDto eventDto){
        
        Event event = Event.builder() 
                .name(eventDto.getName())
                .description(eventDto.getDescription())
//              ...
                .build(); // ì¶”ê°€

        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
        return ResponseEntity.created(createdUri).body(newEvent);
    }
}

```  
* **`EventDto`**ë¥¼ ê°ì²´ë¡œ ì‚¬ìš©í•˜ê³  **`EventRepository`**ë¡œ DBì— ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” **`EventDto`**ë¥¼ **`Event`**ê°ì²´ë¡œ ë³€í™˜ í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” ìœ„ ì¶”ê°€í•œ ì½”ë“œì™€ ê°™ì´ ë°ì´í„°ë¥¼ í•˜ë‚˜í•˜ë‚˜ ë³€í™˜í•´ ì£¼ëŠ” ë°©ë²•ì´ ìˆì§€ë§Œ, ì´ëŠ” ë°ì´í„°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ë³€í™˜í•´ ì¤˜ì•¼ í•˜ëŠ” ê°’ë„ ë§ì•„ì§ì„ ì˜ë¯¸í•œë‹¤.   
* ì´ë¥¼ í•œë²ˆì— ê°€ëŠ¥í•˜ë„ë¡ í•˜ëŠ” **`ModelMapper`**ê°€ ìˆë‹¤.  
  
---    
### pom.xml ìˆ˜ì •  
```html
<dependency>
    <groupId>org.modelmapper</groupId>
    <artifactId>modelmapper</artifactId>
    <version>2.3.1</version>
</dependency>
```  
* **`ModelMapper`**ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ ì¤€ë‹¤.  

### RestApiApplication ìˆ˜ì •  
```java
package me.hantomas.restapi;

import org.modelmapper.ModelMapper;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;

@SpringBootApplication
public class RestApiApplication {

	public static void main(String[] args) {
		SpringApplication.run(RestApiApplication.class, args);
	}

	@Bean
	public ModelMapper modelMapper(){
		return new ModelMapper();
	}
}

```  
* **`RestApiApplication`**ì— **`ModelMapper`**ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ ì¤€ë‹¤.  
  
### ModelMapperë¥¼ ì‚¬ìš©í•œ EventController ë¦¬íŒ©í† ë§  
```java
package me.hantomas.restapi.events;

import org.modelmapper.ModelMapper;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper; // ì¶”ê°€

    public EventController(EventRepository eventRepository, ModelMapper modelMapper){ // ì¶”ê°€
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper; // ì¶”ê°€
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody EventDto eventDto){

        Event event = modelMapper.map(eventDto, Event.class); // ì¶”ê°€

        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
        return ResponseEntity.created(createdUri).body(newEvent);
    }
}

```  
* **`ModelMapper`**ë¥¼ ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ì£¼ì…í•´ì¤€ë‹¤.  
* `Event event = modelMapper.map(eventDto, Event.class);` : `eventDto`ì˜ ê°’ì„ **`Event`**í´ë˜ìŠ¤ì— ì¸ìŠ¤í„´ìŠ¤ë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.  
  
---  
## ê²°ê³¼ (ì˜¤ë¥˜)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/8959254c-37c3-46a6-9fab-9ea47f953162)  
ê°ì²´ ë³€í™˜ë„ ì˜ í•´ì¤¬ëŠ”ë° ìœ„ì™€ ê°™ì´ **NullPointException** ì˜¤ë¥˜ê°€ ë‚˜ê³  ë§ì•˜ë‹¤.  
ê·¸ ì´ìœ ëŠ”,  
```java
@PostMapping
public ResponseEntity createEvent(@RequestBody EventDto eventDto){

    Event event = modelMapper.map(eventDto, Event.class);

    Event newEvent = this.eventRepository.save(event);

    URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
    return ResponseEntity.created(createdUri).body(newEvent);
}
```  
**`EventController`**ì—ì„œ ìš°ë¦¬ê°€ `save()`ì— ì „ë‹¬í•œ ê°ì²´ëŠ” `createEvent()` ë©”ì„œë“œ ë‚´ì—ì„œ ìƒˆë¡œ ë§Œë“¤ì–´ì¤€ ê°ì²´ë‹¤.
ê·¸ë˜ì„œ `Mockito.when(eventRepository.save(event)).thenReturn(event);`ì—ì„œ Stubbingí•´ì¤€ **`event`**ê°ì²´ì™€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— Mockingì´ ì•ˆë˜ì—ˆê³ , ìœ„ì™€ ê°™ì€ **NullPointException** ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.  
  
---  
## ì˜¤ë¥˜ ìˆ˜ì •  
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë” ì´ìƒ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ê°€ ì•„ë‹ˆì—¬ì•¼ í•œë‹¤.  
```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.hamcrest.Matchers;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import java.time.LocalDateTime;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

@RunWith(SpringRunner.class)
@SpringBootTest // ì¶”ê°€
@AutoConfigureMockMvc // ì¶”ê°€
//@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;
//  @MockBean
//  EventRepository eventRepository
    @Test
    public void createEvent() throws Exception{
        Event event = Event.builder()
                .id(100) // ì¶”ê°€
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .free(true) // ì¶”ê°€
                .offline(false) // ì¶”ê°€
                .eventStatus(EventStatus.PUBLISHED) // ì¶”ê°€
                .build();
//      Mockito.when(eventRepository.save(event)).thenReturn(event);  

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("id").value(Matchers.not(100))) // ì¶”ê°€
                .andExpect(jsonPath("free").value(Matchers.not(true))) // ì¶”ê°€
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name())) // ì¶”ê°€
        ;
    }
}

```  
* ë”ì´ìƒ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— **`@WebMvcTest`**ë¥¼ ì‚­ì œí•˜ê³ , **`@SpringBootTest`**ì™€ **`@AutoConfigureMockMvc`**ë¥¼ ì¶”ê°€í•´ ì¤€ë‹¤. **`@SpringBootTest`**ëŠ” Mockingì„ í•œ DispatcherServletì„ ë§Œë“¤ë„ë¡ í•˜ëŠ” ê¸°ë³¸ê°’ë“¤ì´ ë‚´ì¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— MockMvcë¡œ ê³„ì†í•´ì„œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.  
* **`@SpringBootTest`** ë¥¼ ì‚¬ìš©í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í–ˆì„ ë•Œì™€ ê°€ì¥ ê·¼ì‚¬í•œ í˜•íƒœë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ì‹¤ì œ ì›¹ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•  ë•ŒëŠ” **`@SpringBootTest`** ì‚¬ìš©í•˜ëŠ”ë°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Mockingí•´ì¤˜ì•¼ í•  ê²ƒë“¤ì´ ë„ˆë¬´ ë§ì•„ì§€ê¸° ë•Œë¬¸ì´ë‹¤. 
* Mockingì— ê´€ë ¨ëœ ê²ƒë“¤ì€ ì‚­ì œí•´ì¤€ë‹¤.  
  
---  
## ê²°ê³¼ (ì„±ê³µ)  
ì´ë ‡ê²Œ í•˜ë©´ `id(100)` , `free(true)`, `offline(false)`,`eventStatus(EventStatus.PUBLISHED)`ë¡œ ìš”ì²­ì„ ë„£ì–´ ì¤¬ì§€ë§Œ,  
**`Dto`**ëŠ”  ì´ ë°ì´í„°ë“¤ì„ ë‹¤ë£¨ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ ì…ë ¥ë“¤ì„ ë¬´ì‹œí•˜ê²Œëœë‹¤.  
ë”°ë¼ì„œ, `.andExpect(jsonPath("id").value(Matchers.not(100)))`,`.andExpect(jsonPath("free").value(Matchers.not(true)))`,`.andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))`ë¥¼ ë§Œì¡±ì‹œí‚¤ê¸° ë•Œë¬¸ì— ì„±ê³µì ì¸ ì‘ë‹µê°’ì„ ì¶œë ¥í•œë‹¤.  

![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/5aa10ae1-f51d-43fb-a38f-5748ba1c5e2f)   
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/1111b23b-d042-48cd-96fe-583d9af2b263)


