---
title: REST API(3) Event ìƒì„± API êµ¬í˜„ - Event Controller í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°.
date: 2024-02-21 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## êµ¬í˜„ Package ë° Class  
  
## EventControllerTests í´ë˜ìŠ¤ ìƒì„±     
ìš°ì„  í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ **`@RunWith(SpringRunnder.class)`** ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤.  
```java
package me.hantomas.restapi.events;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

@RunWith(SpringRunner.class)
@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Test
    public void createEvent(){
        
    }

}

```  
* **`@WebMvcTest`** :  **`MockMvc`** beanì„ ìë™ ì„¤ì • í•´ì¤€ë‹¤. ì›¹ê³¼ ê´€ë ¨ëœ ë¹ˆë§Œ ë“±ë¡í•´ ì£¼ê¸° ë•Œë¬¸ì— ìŠ¬ë¼ì´ì‹± í…ŒìŠ¤íŠ¸ë¼ê³  í•œë‹¤.  
* **`MockMvc`** : **ìŠ¤í”„ë§ MVC í…ŒìŠ¤íŠ¸ì˜ í•µì‹¬ í´ë˜ìŠ¤**ì´ë‹¤. Mockingë˜ì–´ ìˆëŠ” DispatcherServletì„ ìƒëŒ€ë¡œ ê°€ì§œ ìš”ì²­ì„ ë³´ë‚´ê³  ê·¸ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì›¹ ì„œë²„ë¥¼ ë„ìš°ì§€ ì•Šê³ ë„ ìŠ¤í”„ë§ MVC (DispatcherServlet)ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì„ í™•ì¸ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ìì£¼ ì“°ì¸ë‹¤. ì›¹ ì„œë²„ë¥¼ ë„ìš°ì§€ ì•Šì•„ì„œ ë¹ ë¥´ê¸´ í•˜ì§€ë§Œ DispatcherServlet ê¹Œì§€ ë§Œë“¤ì–´ì•¼ ë˜ê¸° ë•Œë¬¸ì— ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ëŠ” ë¹ ë¥´ì§„ ì•Šë‹¤.  
 
  
---  
## EventControllerTests êµ¬í˜„ (1)
* ì…ë ¥ê°’ë“¤ì„ ì „ë‹¬í•˜ë©´ JSON ì‘ë‹µìœ¼ë¡œ 201ì´ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸ í•´ë³´ì.  
    * **`Location Header`**ì— ìƒì„±ëœ **`ì´ë²¤íŠ¸ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” URI`**ê°€ ë‹´ê²¨ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì.  

```java
package me.hantomas.restapi.events;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;

    @Test
    public void createEvent() throws Exception{
        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                )
                .andDo(print())
                .andExpect(status().isCreated())
        ;
    }
}

```  
* **`perform()`** ì•ˆì— **HTTP ìš”ì²­**ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ”ë°, **`contentType()`**ì„ ì‚¬ìš©í•´ì„œ **ìš”ì²­ì˜ ë³¸ë¬¸ì— ë“¤ì–´ê°€ëŠ” í˜•ì‹**ê³¼ **`accept()`** ë¥¼ ì‚¬ìš©í•´ì„œ **ì›í•˜ëŠ” ì‘ë‹µ í˜•ì‹**ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.  
* **`andExpect()`** ë¡œ ì‘ë‹µì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
**`status().isCreated()`**ëŠ” **`201`** ì‘ë‹µì„ ì˜ë¯¸í•œë‹¤.  
* **`andDo(print())`**ë¥¼ í†µí•´ì„œ ì‹¤ì œ ê°’ë“¤ì´ ì–´ë–»ê²Œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.   

---    
## EventController êµ¬í˜„ (1)  
  
```java
package me.hantomas.restapi.events;

import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;

import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;
import static org.springframework.hateoas.mvc.ControllerLinkBuilder.methodOn;

@Controller
public class EventController {
        
    public ResponseEntity createEvent(){
        URI createdUri = linkTo(methodOn(EventController.class).createEvent()).slash("{id}").toUri();
        return ResponseEntity.created(createdUri).build();
    }
}

```  
* **`@Controller`** ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ ì¤€ë‹¤.  
* **`@PostMapping("/api/events")`** : "/api/events" ê²½ë¡œë¡œì˜ **`POST`** ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œë¥¼ ì •ì˜ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.  
* **linkTo()** ë©”ì„œë“œë¥¼ í†µí•´ linkë¥¼ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆë‹¤. `methodOn(EventController.class).createEvent())` ëŠ” **`EventController`** í´ë˜ìŠ¤ ì•ˆì— ë©”ì„œë“œ **`createEvent()`**ì— ë§í¬ë¥¼ ë§Œë“ ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.<br>`linkTo(methodOn(EventController.class).createEvent()).slash("{id}").toUri();` ğŸ‘‰ `http://localhost/api/events/{id}`  
  
---  

## EventControllerTests ê²°ê³¼ê°’ (1) 
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/9fe08857-9b14-4dd4-9d09-08988286e58a)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/7088f1e6-629d-4641-a0a6-da513a6f960f)  

---  
## EventControllerTests êµ¬í˜„ (2)  
* ì…ë ¥ê°’ë“¤ì„ ì „ë‹¬í•˜ë©´ JSON ì‘ë‹µìœ¼ë¡œ 201ì´ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸ í•´ë³´ì.  
    * **`Location Header`**ì— ìƒì„±ëœ **`ì´ë²¤íŠ¸ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” URI`**ê°€ ë‹´ê²¨ ìˆëŠ”ì§€ í™•ì¸í•´ ë³´ì.  
    * ì„ì˜ì˜ idê°’(10)ì„ ë„£ì–´ì£¼ê³  ê²°ê³¼ë¡œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•´ ë³´ì.  
      
```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import java.time.LocalDateTime;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    public void createEvent() throws Exception{
        Event event = Event.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
        ;
    }
}

```  
* **`ObjectMapper`** : ìš°ë¦¬ëŠ” ìš”ì²­í•  ë°ì´í„°ì˜ contentTypeì„ JSONìœ¼ë¡œ ì„¤ì •í–ˆë‹¤. ë”°ë¼ì„œ ê°’ì„ JSONìœ¼ë¡œ ì¤˜ì•¼í•˜ëŠ”ë°, SpringBootì—ëŠ” ì´ë¯¸ **`ObjectMappper`**ê°€ ë¹ˆìœ¼ë¡œ ë“±ë¡ì´ ë˜ì–´ìˆì–´ì„œ,`.content(objectMapper.writeValueAsString(event))`ì„ í†µí•´ ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë°”ê¾¸ì–´ ë³¸ë¬¸ì— ë„£ì–´ ì¤„ ìˆ˜ ìˆë‹¤.  
  
---  
## EventController êµ¬í˜„ (2)  
  
```java
package me.hantomas.restapi.events;

import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    @PostMapping
    public ResponseEntity createEvent(@RequestBody Event event){
        URI createdUri = linkTo(EventController.class).slash("{id}").toUri();
        event.setId(10);
        return ResponseEntity.created(createdUri).body(event);
    }
}

```  
* **`@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)`** : RequsetMapping ì•ˆì— ìˆëŠ” ëª¨ë“  í•¸ë“¤ëŸ¬ë“¤ì€ HAL_JSON_UTF8_VALUE íƒ€ì…ì˜ ì‘ë‹µì„ ë³´ë‚´ê²Œ ëœë‹¤. **`@PostMapping`**ì˜ ê²½ë¡œëŠ” ì§€ì›Œì¤˜ë„ ëœë‹¤.  
* **`@RequestBody Event event`** : ìš”ì²­ ë³¸ë¬¸ì— ìˆëŠ” ë°ì´í„°ë¥¼ **`event`**ì— ë§¤í•‘í•œë‹¤.  
* **`methodOn()`** ì§€ì •ì„ í’€ì–´ì¤€ë‹¤.  
* ì„ì˜ì˜ id(10)ì„ **`event.setId(10);`** ì§€ì •í•´ ì¤€ë‹¤.  
* **`.body(event);`** ê°ì²´ë¥¼ bodyì— ë‹´ì•„ì„œ ë³´ë‚´ì¤€ë‹¤.  
  
---  
## EventControllerTests ê²°ê³¼ê°’ (2)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/d0d48fc2-0353-4c5b-90bf-a3fa74c7d384)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/ad9ac7c6-eaca-470a-b457-7f694245d866)




