---
title: REST API(7) Event ìƒì„± API êµ¬í˜„ - ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì ìš©
date: 2024-02-26 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## êµ¬í˜„ Package ë° Class  
  
## ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©  
**`Event`** ë„ë©”ì¸ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì ìš©í•  ê²ƒì´ë‹¤.  
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì˜ˆë¥¼ ë“¤ë©´, **`Event`**ì—ì„œ `basePrice`ì™€ `maxPrice`ê°€ ì¡´ì¬í•œë‹¤ë©´, ê·¸ ì´ë²¤íŠ¸ëŠ” `free`ê°€ `true`ì¼ ìˆ˜ ì—†ë‹¤. ë˜, `location`ì´ ì¡´ì¬í•˜ë©´, ê·¸ ì´ë²ˆíŠ¸ëŠ” `offline`ì´ `true`ì´ì—¬ì•¼ í•œë‹¤.   
  
### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë€?  
* ë„ë©”ì¸ ë¡œì§ì´ë¼ê³ ë„ í•œë‹¤.  
* ì»´í“¨í„° í”„ë¡œê·¸ë¨ì—ì„œ ì‹¤ì„¸ê³„ì˜ ê·œì¹™ì— ë”°ë¼ ë°ì´í„°ë¥¼ ìƒì„±, í‘œì‹œ, ì €ì¥, ë³€ê²½í•˜ëŠ” ë¶€ë¶„ì„ ì¼ì»«ëŠ”ë‹¤. íŠ¹íˆ ë°ì´í„°ë² ì´ìŠ¤, í‘œì‹œì¥ì¹˜ ë“± í”„ë¡œê·¸ë¨ì˜ ë‹¤ë¥¸ ë¶€ë¶„ê³¼ ëŒ€ì¡°ë˜ëŠ” ê°œë…ìœ¼ë¡œ ì“°ì¸ë‹¤.  
* í˜„ì‹¤ ì„¸ìƒì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì½”ë“œ  
* ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì„ ì»´í“¨í„°ì—ê²Œ ì˜ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì§œì—¬ì§„ ì½”ë“œ ë¡œì§  
  
### Event  
**`Event`** ë„ë©”ì¸ì— `update()`ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì ìš©í•œë‹¤.  
```java
package me.hantomas.restapi.events;

import lombok.*;

import javax.persistence.*;
import java.time.LocalDateTime;

@Builder @AllArgsConstructor @NoArgsConstructor
@Getter @Setter @EqualsAndHashCode(of = "id")
@Entity
public class Event {
    @Id @GeneratedValue
    private Integer id;
    private String name;
    private String description;
    private LocalDateTime beginEnrollmentDateTime;
    private LocalDateTime closeEnrollmentDateTime;
    private LocalDateTime beginEventDateTime;
    private LocalDateTime endEventDateTime;
    private String location;
    private int basePrice;
    private int maxPrice;
    private int limitOfEnrollment;
    private boolean offline;
    private boolean free;
    @Enumerated(EnumType.STRING)
    private EventStatus eventStatus = EventStatus.DRAFT;

    public void update(){
        // Update free
        if(this.basePrice == 0 && this.maxPrice == 0){
            this.free = true;
        } else{
            this.free = false;
        }

        // Update offline
        if(this.location == null || this.location.isBlank()){
            this.offline = false;
        } else{
            this.offline = true;
        }
    }
}

```  
* `isBlank()` : Java 11 ì´í›„ë¡œ ì œê³µí•˜ëŠ” ë©”ì†Œë“œë¡œ,`isEmpty()`ì™€ ë‹¬ë¦¬ ë¹ˆ ê³µë°±ì„ ì•Œì•„ì„œ trimí•´ì¤€ë‹¤. ë”°ë¼ì„œ,`isEmpty()`ëŠ” ë¬¸ìì—´ì˜ ê¸¸ì´ê°€ 0ì¸ ê²½ìš°ì—ë§Œ `true`ë¥¼ ë¦¬í„´í•˜ì§€ë§Œ, `isBlank()`ì˜ ê²½ìš° ë¬¸ìì—´ì´ ë¹„ì–´ ìˆê±°ë‚˜, ë¹ˆ ê³µë°±ìœ¼ë¡œë§Œ ì´ë£¨ì–´ì ¸ ìˆì–´ë„, `true`ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.  
  
---
### EventTest  
**`EventTest`**ì—ì„œ ì´ë¥¼ í…ŒìŠ¤íŠ¸í•œë‹¤.  
```java
// import ìƒëµ

public class EventTest {
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ìƒëµ

    @Test // freeì— ëŒ€í•œ í…ŒìŠ¤íŠ¸
    public void testFree(){ 
        // Given
        Event event = Event.builder()
                .basePrice(0)
                .maxPrice(0)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isTrue();

        // Given
        event = Event.builder()
                .basePrice(100)
                .maxPrice(0)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isFalse();

        // Given
        event = Event.builder()
                .basePrice(0)
                .maxPrice(100)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isFalse();
    }

    @Test // offlineì— ëŒ€í•œ í…ŒìŠ¤íŠ¸
    public void  testOffline(){
        // Given
        Event event = Event.builder()
                .location("ê°•ë‚¨ì—­ ë„¤ì´ë²„ D2 ìŠ¤íƒ€í… íŒ©í† ë¦¬")
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isOffline()).isTrue();

        // Given
        event = Event.builder()
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isOffline()).isFalse();
    }
}
```  
### ê²°ê³¼(ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3e0d9fee-9a09-4474-8b2f-197777a727b9)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/5814d683-9324-44e8-8715-21452387917e)  
  
---  
### EventController  
**`EventController`**ì— **`Event`**ì˜ `update()`ë¥¼ ì ìš© ì‹œí‚¨ë‹¤.  
```java
package me.hantomas.restapi.events;

import org.modelmapper.ModelMapper;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.validation.Errors;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.validation.Valid;
import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    private final EventValidator eventValidator;

    public EventController(EventRepository eventRepository, ModelMapper modelMapper, EventValidator eventValidator) {
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper;
        this.eventValidator = eventValidator;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){

        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        eventValidator.validate(eventDto, errors);
        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        Event event = modelMapper.map(eventDto, Event.class);
        event.update(); // ì¶”ê°€
        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri();
        return ResponseEntity.created(createdUri).body(newEvent);
    }
}

```  
  
---  
### EventControllerTests  
```java
// import ìƒëµ

@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false)) // ìˆ˜ì •
                .andExpect(jsonPath("offline").value(true)) // ìˆ˜ì •
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
        ;
    }
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
}

```  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/ceccbecf-1309-4511-acbe-4cabb95d3b42)  
  
---  
## ë§¤ê°œë³€ìˆ˜ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸  
**`EventTest`**ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚´í´ë³´ì.  
```java
// import ìƒëµ

public class EventTest {
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ìƒëµ

    @Test // freeì— ëŒ€í•œ í…ŒìŠ¤íŠ¸
    public void testFree(){ 
        // Given
        Event event = Event.builder()
                .basePrice(0)
                .maxPrice(0)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isTrue();

        // Given
        event = Event.builder()
                .basePrice(100)
                .maxPrice(0)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isFalse();

        // Given
        event = Event.builder()
                .basePrice(0)
                .maxPrice(100)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isFalse();
    }

    @Test // offlineì— ëŒ€í•œ í…ŒìŠ¤íŠ¸
    public void  testOffline(){
        // Given
        Event event = Event.builder()
                .location("ê°•ë‚¨ì—­ ë„¤ì´ë²„ D2 ìŠ¤íƒ€í… íŒ©í† ë¦¬")
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isOffline()).isTrue();

        // Given
        event = Event.builder()
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isOffline()).isFalse();
    }
}
```  
í…ŒìŠ¤íŠ¸ë“¤ì„ ë³´ë©´ íŒŒë¼ë¯¸í„°ë§Œ ë‹¤ë¥¼ ë¿, ì¤‘ë³µëœ ì½”ë“œê°€ ë§ì•„ë³´ì¸ë‹¤. ì´ë¥¼ **`JUnitParams`**ë¥¼ ì´ìš©í•˜ì—¬, ë§¤ê°œë³€ìˆ˜ë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ë¡œ ë¦¬íŒ©í† ë§ í•´ë³´ê² ë‹¤.  
### ì˜ì¡´ì„± ì¶”ê°€(pom.xml)  
```html
<dependency>
    <groupId>pl.pragmatists</groupId>
    <artifactId>JUnitParams</artifactId>
    <version>1.1.1</version>
    <scope>test</scope>
</dependency>
```  
  
---  
### EventTest ë°©ë²• (1)  
```java
// import ìƒëµ
import junitparams.JUnitParamsRunner;
import junitparams.Parameters;
import org.junit.runner.RunWith;


@RunWith(JUnitParamsRunner.class)
public class EventTest {
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ìƒëµ

    @Test
    @Parameters({
            "0, 0, true",
            "100, 0, false",
            "0, 100, false"
    })
    public void testFree(int basePrice, int maxPrice, boolean isFree){
        // Given
        Event event = Event.builder()
                .basePrice(basePrice)
                .maxPrice(maxPrice)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isEqualTo(isFree);
    }

    
}
```  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3bd42653-b89d-43d7-b55e-9832110279ac)  
  
---  
### EventTest ë°©ë²• (2)  
```java
// import ìƒëµ
import junitparams.JUnitParamsRunner;
import junitparams.Parameters;
import org.junit.runner.RunWith;


@RunWith(JUnitParamsRunner.class)
public class EventTest {
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ìƒëµ

    @Test
    @Parameters(method = "paramsForTestFree")
    public void testFree(int basePrice, int maxPrice, boolean isFree){
        // Given
        Event event = Event.builder()
                .basePrice(basePrice)
                .maxPrice(maxPrice)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isEqualTo(isFree);
    }

    private Object[] paramsForTestFree(){
        return new Object[]{
                new Object[] {0, 0, true},
                new Object[] {100, 0, false},
                new Object[] {0, 100, false},
                new Object[] {100, 200, false}
        };
    }

    
}
```  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/8c633ff5-c0c0-4f8f-b2c1-d7d35d3ae5f8)  
  
---  
### EventTest (ìµœì¢…)  
```java
// import ìƒëµ
import junitparams.JUnitParamsRunner;
import junitparams.Parameters;
import org.junit.runner.RunWith;


@RunWith(JUnitParamsRunner.class)
public class EventTest {
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ìƒëµ

    @Test
    @Parameters // ìˆ˜ì •
    public void testFree(int basePrice, int maxPrice, boolean isFree){
        // Given
        Event event = Event.builder()
                .basePrice(basePrice)
                .maxPrice(maxPrice)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isFree()).isEqualTo(isFree);
    }

    private Object[] paramsForTestFree(){
        return new Object[]{
                new Object[] {0, 0, true},
                new Object[] {100, 0, false},
                new Object[] {0, 100, false},
                new Object[] {100, 200, false}
        };
    }

    @Test
    @Parameters // ìˆ˜ì •
    public void  testOffline(String location, boolean isOffline){
        // Given
        Event event = Event.builder()
                .location(location)
                .build();
        // When
        event.update();

        // Then
        assertThat(event.isOffline()).isEqualTo(isOffline);
    }

    private Object[] parametersForTestOffline(){
        return new Object[]{
                new Object[]{"ê°•ë‚¨", true},
                new Object[]{null, false},
                new Object[]{"       ", false}
        };
    }

    
}
```   
* **`@Parameters`** : **`@Parameters`**ì˜`(method = "")`ë¶€ë¶„ì„ ìƒëµí•´ ì£¼ì–´ë„ ëœë‹¤. **`@Parameters`**ëŠ” `parametersFor`ë¼ëŠ” prefixê°€ ë¶™ì€, í…ŒìŠ¤íŠ¸ì™€ ê°™ì€ ì´ë¦„ì˜ Objectë¥¼ ìë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•œë‹¤.  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/a3a602fc-886a-45c9-bb1e-fef03c29546f)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/7878d8d9-5047-4a6d-af24-efff541eb441)  




