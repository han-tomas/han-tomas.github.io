---
title: REST API(4) Event ìƒì„± API êµ¬í˜„ - Event Repository êµ¬í˜„
date: 2024-02-22 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## êµ¬í˜„ Package ë° Class  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/6feadf67-f086-46b4-9182-7c769c0948ff)  

## Event Repository  
**`event`** ê°ì²´ë¥¼ **ì‹¤ì œ DBì— ì €ì¥**í•  ìˆ˜ ìˆë„ë¡ **`EventRepository`**ë¥¼ êµ¬í˜„í•´ ë³´ì.  
  
## Event  
```java
package me.hantomas.restapi.events;

import lombok.*;

import javax.persistence.*;
import java.time.LocalDateTime;

@Builder @AllArgsConstructor @NoArgsConstructor
@Getter @Setter @EqualsAndHashCode(of = "id")
@Entity
public class Event {
    @Id @GeneratedValue
    private Integer id;
    private String name;
    private String description;
    private LocalDateTime beginEnrollmentDateTime;
    private LocalDateTime closeEnrollmentDateTime;
    private LocalDateTime beginEventDateTime;
    private LocalDateTime endEventDateTime;
    private String location;
    private int basePrice;
    private int maxPrice;
    private int limitOfEnrollment;
    private boolean offline;
    private boolean free;
    @Enumerated(EnumType.STRING)
    private EventStatus eventStatus = EventStatus.DRAFT;
}

```  
* **`@Entity`** : ìš°ì„  **`Event`**ë¥¼ Entityë¥¼ ë§Œë“¤ì–´ ì£¼ê¸°ìœ„í•´ **`@Entity`** ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•œë‹¤.  
* **`@Id`** : JPAë¡œ í…Œì´ë¸”ê³¼ ì—”í‹°í‹°ë¥¼ ë§¤í•‘í•  ë•Œ, ì‹ë³„ìë¡œ ì‚¬ìš©í•  í•„ë“œ ìœ„ì— **`@Id`** ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ í…Œì´ë¸”ì˜ **Primary Key**ì™€ ì—°ê²° ì‹œì¼œì¤˜ì•¼í•œë‹¤.  
* **`@GeneratedValue`** : ì´ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì‹ë³„ì ê°’ì„ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤.  
* **`@Enumerated(EnumType.STRING)`** : ê¸°ë³¸ EnumTypeì€ **`ORDINAL`**ì¸ë°, ì´ëŠ” **`enum`**ì˜ ìˆœì„œì— ë”°ë¼ 0ë²ˆë¶€í„° ì •ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤. ë”°ë¼ì„œ **`STRING`** íƒ€ì…ì„ ë°”ê¾¸ì–´, ì €ì¥ëœ ë¬¸ìì—´ë¡œ ë°˜í™˜í•˜ë„ë¡ í•˜ê³ , ë‚˜ì¤‘ì— **`enum`**ì˜ ìˆœì„œê°€ ë°”ë€Œì–´ë„ ë°ì´í„°ê°€ ê¼¬ì´ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.  
  
---  
## EventRepository  
```java
package me.hantomas.restapi.events;

import org.springframework.data.jpa.repository.JpaRepository;

public interface EventRepository extends JpaRepository<Event, Integer> {
}
```  
* **`EventRepository`**ë¥¼ **`interface`**ë¡œ ë§Œë“¤ì–´ ì£¼ê³ , **`JpaRepository<T, id>`**ë¥¼ ìƒì† ë°›ëŠ”ë‹¤.  
* **`JpaRepository`**ë¥¼ ì‚¬ìš©í•˜ë©´, ë³µì¡í•œ **JDBC(Java DataBase Connectivity)** ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ê°„ë‹¨í•˜ê²Œ DBì™€ì˜ ë°ì´í„° ì ‘ê·¼ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.JPARepository ì¸í„°í˜ì´ìŠ¤ëŠ” ì œë„¤ë¦­ íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ Entityí´ë˜ìŠ¤ì™€ í•´ë‹¹ Entityì˜ IDí´ë˜ìŠ¤ë¥¼ ëª…ì‹œí•œë‹¤.  
  
---  
## EventController ìˆ˜ì •  
```java
package me.hantomas.restapi.events;

import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    public EventController(EventRepository eventRepository){
        this.eventRepository = eventRepository;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody Event event){
        Event newEvent = this.eventRepository.save(event);

        URI createdUri = linkTo(EventController.class).slash(newEvent.getId()).toUri(); // "{id}"ë¥¼ newEvent.getId()ë¡œ ìˆ˜ì •
        return ResponseEntity.created(createdUri).body(newEvent); // ìˆ˜ì •
    }
}


```  

```java
private final EventRepository eventRepository;

public EventController(EventRepository eventRepository){
    this.eventRepository = eventRepository;
}
```  
* ìœ„ì—ì„œ EventRepositoryë¥¼ **`@AutoWired`**ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì´ ì²˜ëŸ¼ **ìƒì„±ì ì£¼ì… ë°©ì‹**ìœ¼ë¡œ ì£¼ì…í•˜ì˜€ë‹¤.  
* í´ë˜ìŠ¤ê°€ ìƒì„±ë  ë‹¹ì‹œ ì´ˆê¸° ì‹¤í–‰ê³¼ í•œ ë²ˆ ì‹¤í–‰ì˜ ë³´ì¥, final í‚¤ì›Œë“œë¥¼ í†µí•œ ë¶ˆë³€, ë¬¸ì œ ë°œìƒì‹œ ì»´íŒŒì¼ íƒ€ì„ì—ì„œì˜ ì—ëŸ¬ ë“±ë“± ì—¬ëŸ¬ ì¥ì ë“¤ì´ ìˆì–´ì„œ, ê³µì‹ ë¬¸ì„œ ë° ì‹¤ë¬´ì—ì„œë„ **ìƒì„±ì ì£¼ì… ë°©ì‹**ì„ ì„ í˜¸í•˜ê³  ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  í•œë‹¤.  
  
---  
## ê²°ê³¼(ì˜¤ë¥˜)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/a5756954-da02-487d-9e12-6c0904ce665f)  

* **`@WebMvcTest`**ì€ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸ë¡œì„œ, ì›¹ìš© ë¹ˆë“¤ë§Œ ë“±ë¡ì„ í•´ì£¼ê³ ,**`Repository`**ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì£¼ì§€ ì•Šì•„ì„œ ê·¸ëŸ°ë‹¤ê³  í•œë‹¤.     
  
## ì˜¤ë¥˜ ìˆ˜ì • (EvnetControllerTests)  
ë”°ë¼ì„œ, **`Repository`**ë¥¼ Mockingí•´ì£¼ë©´ ëœë‹¤.      
```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import java.time.LocalDateTime;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;
    @MockBean
    EventRepository eventRepository; // ì¶”ê°€

    @Test
    public void createEvent() throws Exception{
        Event event = Event.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
        ;
    }
}

```  
## ê²°ê³¼(ì˜¤ë¥˜) (2) 
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/a0cfe809-efba-4ba0-b053-c5d6de9ce0ea)  
* **NullPointException** : **`EventControllerTests`**ì—ì„œ Mockingí•œ **`Repository`**ëŠ” Mock ê°ì²´ì´ê¸° ë•Œë¬¸ì— **`EventController`**ì—ì„œ `save()`í•´ë„ ë¦¬í„´ ë˜ëŠ” ê°’ì€ **`Null`**ì´ë‹¤.  

## ì˜¤ë¥˜ ìˆ˜ì • (EvnetControllerTests)  
ë”°ë¼ì„œ, **`EventController`**ì—ì„œ `save()`ê°€ í˜¸ì¶œ ëì„ ë•Œ, EventControllerTestsì—ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ë™ì‘ì„ í•´ì•¼í•˜ëŠ” ì§€ **Stubbing**<sup>[1](#f1)</sup> í•´ì£¼ë©´ ëœë‹¤.  
<span style="font-size: 10px; text-align : right"><b id="f1">1</b>: í…ŒìŠ¤íŠ¸ ìŠ¤í…(Test Stub)ì€ í…ŒìŠ¤íŠ¸ í˜¸ì¶œ ì¤‘ í…ŒìŠ¤íŠ¸ ìŠ¤í…ì€ í…ŒìŠ¤íŠ¸ ì¤‘ì— ë§Œë“¤ì–´ì§„ í˜¸ì¶œì— ëŒ€í•´ ë¯¸ë¦¬ ì¤€ë¹„ëœ ë‹µë³€ì„ ì œê³µí•˜ëŠ” ê²ƒ</span>  

```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;

import java.time.LocalDateTime;

import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@RunWith(SpringRunner.class)
@WebMvcTest
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;
    @MockBean
    EventRepository eventRepository;

    @Test
    public void createEvent() throws Exception{
        Event event = Event.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();
        event.setId(10); // ì¶”ê°€ 
        Mockito.when(eventRepository.save(event)).thenReturn(event); // ì¶”ê°€

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION)) // ì¶”ê°€
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE)) //ì¶”ê°€
        ;
    }
}

```  
* `event.setId(10);` : eventì— idë¥¼ 10ìœ¼ë¡œ ì¶”ê°€í•´ ì£¼ê³ .
* `Mockito.when(eventRepository.save(event)).thenReturn(event);` : `eventRepository.save(event)`ê°€ í˜¸ì¶œ ë˜ì—ˆì„ ë•Œ, `event`ë¥¼ ë¦¬í„´í•˜ë¼ê³  Stubbing.  
* ì¶”ê°€ë¡œ **`Header`**ì— **`Location`**ì´ ìˆëŠ”ì§€ **`Content-Type`**ì€ ìš”ì²­í•œëŒ€ë¡œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
  
---  
## ê²°ê³¼ (ì„±ê³µ)    
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/1f31d4e3-9219-45d4-ae54-f428e4cae846)  
