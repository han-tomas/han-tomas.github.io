---
title: REST API(10) í…ŒìŠ¤íŠ¸ìš© DB ì„¤ì • ë¶„ë¦¬í•˜ê¸°
date: 2024-03-04 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
Docker,
Container,
PostgreSQL,
H2,
]     
---  
## í…ŒìŠ¤íŠ¸ìš© DB(H2) / ì• í”Œë¦¬ì¼€ì´ì…˜ìš© DB(PostgreSQL) 
í…ŒìŠ¤íŠ¸ í•  ë•ŒëŠ” ê³„ì† H2ë¥¼ ì‚¬ìš©í•´ë„ ì¢‹ì§€ë§Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¥¼ ì‹¤í–‰í•  ë•Œ PostgreSQLì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•˜ì.  
  
## Docker ì„¤ì¹˜  
ìš°ì„  [Docker](https://www.docker.com/get-started/)ë¥¼ ì„¤ì¹˜í•´ ì£¼ì—ˆë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/6ae09b2e-ef05-4ac3-9188-1267726da1db)  
  
---  
### PostgreSQL ì»¨í…Œì´ë„ˆ ì‹¤í–‰  
ë„ì»¤ë¡œ PostgreSQL ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ëª…ë ¹ì–´ì´ë‹¤.  
```
$ docker run --name rest -p 5432:5432 -e POSTGRES_PASSWORD=pass -d postgres
```  
`rest` ë¥¼ ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ í•˜ì—¬, `-p` ì˜µì…˜ìœ¼ë¡œ port ë§¤í•‘, `-e` ì˜µì…˜ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •, `-d`ë¡œ ë°ëª¬ ëª¨ë“œë¡œ ì„¤ì •í–ˆë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/6e7604e2-bc1c-4fb5-a5e7-334625ade985)  
`$ docker ps` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì»¨í…Œì´ë„ˆ ëª©ë¡ì—ì„œ rest ì»¨í…Œì´ë„ˆë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
  
---  
### ë„ì»¤ ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°€ê¸°  
ë‹¤ìŒì€ ë„ì»¤ ì»¨í…Œì´ë„ˆì— ë“¤ì–´ê°€ê¸° ìœ„í•œ ëª…ë ¹ì–´ì´ë‹¤.  
```
$ docker exec -i -t rest bash # target ì»¨í…Œì´ë„ˆë¥¼ rest ë¡œ ì§€ì •
$ su - postgres # postgresë¡œ user ë³€ê²½
$ psql -d postgres -U postgres
$ \l # ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ í™•ì¸
$ \dt # í…Œì´ë¸” í™•ì¸
```  
  
---  
## DB ì„¤ì • ë¶„ë¦¬í•˜ê¸°  
ì´ì œ **í…ŒìŠ¤íŠ¸ìš© DBëŠ” H2**ë¡œ, **ì• í”Œë¦¬ì¼€ì´ì…˜ìš© DBëŠ” PostgreSQL**ë¡œ ë¶„ë¦¬í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ê² ë‹¤.  
  
### H2 DB Test scopeìœ¼ë¡œ ë³€ê²½  
testì—ì„œ H2 Databaseë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ pom.xmlì—ì„œ h2databaseë¥¼ test scopeìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤.  
```html
<dependency>
	<groupId>com.h2database</groupId>
	<artifactId>h2</artifactId>
	<scope>test</scope>  
</dependency>
```  
  
---  
### application.properties  
ë°ì´í„°ì†ŒìŠ¤ì™€ í•˜ì´ë²„ë„¤ì´íŠ¸ ì„¤ì •ì„ ìœ„í•´ applicaion.properties ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤.  
í•˜ì´ë²„ë„¤ì´íŠ¸ ì„¤ì •ì„ í†µí•´ ì´ë²¤íŠ¸ì— ëŒ€í•œ í…Œì´ë¸”ì„ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆê³ , ìš°ë¦¬ê°€ ì¿¼ë¦¬ê°€ ë³¼ ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë‹¤.  
  
```
spring.jackson.deserialization.fail-on-unknown-properties=true 

spring.datasource.username=postgres
spring.datasource.password=pass
spring.datasource.url=jdbc:postgresql://localhost:5432/postgres
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.format_sql=true

logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE  
```  
  
---  
### application-test.properties  
í…ŒìŠ¤íŠ¸ì—ì„œ H2 Databaseë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” í…ŒìŠ¤íŠ¸ì— ëŒ€í•œ `application.properties`ê°€ í•„ìš”í•˜ë‹¤.  
`test` ì•ˆì— `resources` ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ì—¬ ì„¤ì • íŒŒì¼(application.properties)ì„ ì¶”ê°€í•´ì¤€ë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/89a02464-77e3-465a-b806-93fe0a43b9f5)   
í•˜ì§€ë§Œ ì´ëŸ´ ê²½ìš° **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ê³¼ í…ŒìŠ¤íŠ¸ ì„¤ì •ì´ ì¤‘ë³µ**ëœë‹¤.  
   
ë”°ë¼ì„œ, ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ ì„¤ì • íŒŒì¼ì˜ ì´ë¦„ì„ `application-test.properties` ë¡œ ë³€ê²½í•˜ê³ ,  
ë‚´ìš©ì„ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•˜ì—¬ ì˜¤ë²„ë¼ì´ë”© í•˜ê³  ì‹¶ì€ ê²ƒë§Œ ë‚¨ê¸´ë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/91b318a9-2e3b-461d-a9ce-a057b9f7a793)  
  
### EventControllerTests ìˆ˜ì •  
í…ŒìŠ¤íŠ¸ì—ì„œ ì´ ì„¤ì •ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ **`EventControllerTests`** ì— **`@ActiveProfiles("test")`** ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ë©´ **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ê³¼ í…ŒìŠ¤íŠ¸ ì„¤ì • ì¤‘ë³µì„ í”¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.**  
```java
// import ìƒëµ
import org.springframework.test.context.ActiveProfiles; // ì¶”ê°€  
@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class)
@ActiveProfiles("test") // ì¶”ê°€
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    // í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ 

}

```  
### ê²°ê³¼(ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/22ea53aa-3313-493c-adfb-adc70d6fa542)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/d90eeba5-f4ed-48db-988f-8005b237765d)  
  





