---
title: REST API(9) Spring REST Docs - Self - Descriptive Message ì ìš©
date: 2024-03-01 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## Spring REST Docs ì†Œê°œ  
Spring REST Docs í”„ë¡œì íŠ¸ëŠ” Spring MVC Testë¥¼ ì‚¬ìš©í•´ì„œ ë¬¸ì„œì˜ snippet(REST APIì˜ ë¬¸ì„œ ì¡°ê°)ë“¤ì„ ìƒì„±í•  ë•Œ ìœ ìš©í•œ ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë‹¤.  
Testë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œ ìš”ì²­(Request)ì™€ ì‘ë‹µ(Response), ì‘ë‹µì— ì‹¤ë ¤ìˆëŠ” í—¤ë”(Header) ë“±ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•´ snippet(ë¬¸ì„œ ì¡°ê°)ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ë‚˜ì¤‘ì— ì´ snippetë“¤ì„ ëª¨ì•„ì„œ REST API documentation(HTML)ì„ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.  
ê¸°ë³¸ì ìœ¼ë¡œ Spring REST docsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Asciidoctorë¼ëŠ” íˆ´ì„ ì‚¬ìš©í•œë‹¤. ì´ Asciidoctorë¥¼ ì‚¬ìš©í•˜ë©´ plain textë¡œ ì‘ì„±í•œ ë¬¸ì„œë¥¼ Asciidocì´ë¼ëŠ” íŠ¹ë³„í•œ ë¬¸ë²•(ë§ˆí¬ë‹¤ìš´ì´ë‘ ë¹„ìŠ·í•œ)ì— ë§ì¶° snippetë“¤ì„ ë§Œë“¤ê³ , ì´ë¥¼ ì¡°í•©í•´ì„œ ì¡°í•©í•´ì„œ HTML ë¬¸ì„œë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.  
ìš°ë¦¬ê°€ MockMVCë¥¼ í†µí•´ ë§Œë“  Testë“¤ì„ REST docsì™€ ì—°ë™í•  ìˆ˜ ìˆë‹¤.  
  
---  
## Spring REST Docs ì ìš©  
ì´ì œ Spring REST Docsë¥¼ ìš°ë¦¬ì˜ APIì— ì ìš©ì‹œì¼œ ë³´ì.  

### EventControllerTests ìˆ˜ì • (1)  
```java
// import ìƒëµ
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs; // ì¶”ê°€(1)


import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document; // ì¶”ê°€(2)


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs // ì¶”ê°€(1)
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event")); // ì¶”ê°€(2)
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* **`@AutoConfigureRestDocs`** : ì´ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ Spring REST Docsë¥¼ ìë™ ì„¤ì • í•  ìˆ˜ ìˆë‹¤..  
* `.andDo(document("create-event"));` : ì•„ë˜ì™€ ê°™ì´ `./target/generated-snippets/create-event/`ë””ë ‰í† ë¦¬ ë‚´ì— ë¬¸ì„œê°€ ìƒì„±ëœë‹¤.  
  
---  
### ê²°ê³¼ (1)
í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ì„œê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/39fa8d85-b969-4d93-9834-5679b1ed9471)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/21f6d08e-8314-4346-ae72-6ee8c83defc9)  
ìœ„ REST Docs íŒŒì¼ í•˜ë‚˜ë§Œ ì˜ˆë¡œ ì‚´í´ë³´ì. ì¶œë ¥ ê°’ì´ Formatingì´ ì•ˆë˜ì–´ ë³´ê¸° ë¶ˆí¸í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
ì´ë¥¼ Formatingí•˜ë ¤ë©´ **`RestDocMockMvc`**ë¥¼ ì»¤ìŠ¤ë§ˆì´ì§•í•˜ë©´ ëœë‹¤. ìš°ì„ , **`RestDocsMockMvcConfigurationCustomizer`**ë¥¼ êµ¬í˜„í•œ ë¹ˆì„ ë“±ë¡í•˜ì.  
  
---  
### RestDocsConfiguration ìƒì„±  
ìš°ì„  **`RestDocsMockMvcConfigurationCustomizer`**ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê¸° ìœ„í•´ Rest Docs í™˜ê²½ ì„¤ì •ì„ í•´ì¤„ **`RestDocsConfiguration`** í´ë˜ìŠ¤ íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.  
```java
package me.hantomas.restapi.common;

import org.springframework.boot.test.autoconfigure.restdocs.RestDocsMockMvcConfigurationCustomizer;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.context.annotation.Bean;
import org.springframework.restdocs.mockmvc.MockMvcRestDocumentationConfigurer;

import static org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;

@TestConfiguration
public class RestDocsConfiguration {

    @Bean
    public RestDocsMockMvcConfigurationCustomizer restDocsMockMvcConfigurationCustomizer() {
        return configurer -> configurer.operationPreprocessors()
                .withRequestDefaults(prettyPrint())
                .withResponseDefaults(prettyPrint());
    }
}

```   
* `prettyPrint()`ë©”ì†Œë“œë¥¼ í†µí•´ ì¶œë ¥ ë¬¸ì„ ë³´ê¸° ì¢‹ê²Œ formating í•œë‹¤.  
* ìœ„ ì½”ë“œì—ì„œëŠ” **Lamdaí‘œí˜„ì‹**ì„ ì¼ëŠ”ë° ì´ëŠ” ë”°ë¡œ ë¸”ë¡œê·¸ì— ì •ë¦¬í•´ë³´ê² ë‹¤.  
  
---  
### EventControllerTests ìˆ˜ì • (2)  
```java
// import ìƒëµ
import org.springframework.context.annotation.Import; // ì¶”ê°€


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class) // ì¶”ê°€
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event"));
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* **`@Import(RestDocsConfiguration.class)`**ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ì—¬ ë‹¤ë¥¸ ë¹ˆ ì„¤ì • íŒŒì¼ì¸ `RestDocsConfigurateion.class`ë¥¼ importí•´ì„œ ì‚¬ìš©í•œë‹¤.
  
---  
### ê²°ê³¼ (2)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/71f2f4ac-5168-4ef0-924d-68a32c8079cc)  
  




