---
title: REST API(9) Spring REST Docs - Self - Descriptive Message 적용
date: 2024-03-01 00:00:00 +0900
categories: [⚙️Back-End, 🍃Spring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## Spring REST Docs 소개  
Spring REST Docs 프로젝트는 Spring MVC Test를 사용해서 문서의 snippet(REST API의 문서 조각)들을 생성할 때 유용한 기능을 제공해주는 기능이다.  
Test를 실행할 때 사용한 요청(Request)와 응답(Response), 응답에 실려있는 헤더(Header) 등의 정보를 사용해 snippet(문서 조각)을 만들 수 있다. 나중에 이 snippet들을 모아서 REST API documentation(HTML)을 완성할 수 있다.  
기본적으로 Spring REST docs는 기본적으로 Asciidoctor라는 툴을 사용한다. 이 Asciidoctor를 사용하면 plain text로 작성한 문서를 Asciidoc이라는 특별한 문법(마크다운이랑 비슷한)에 맞춰 snippet들을 만들고, 이를 조합해서 조합해서 HTML 문서로 만들어 준다.  
우리가 MockMVC를 통해 만든 Test들을 REST docs와 연동할 수 있다.  
  
---  
## Spring REST Docs 적용  
이제 Spring REST Docs를 우리의 API에 적용시켜 보자.  

### EventControllerTests 수정 (1)  
```java
// import 생략
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs; // 추가(1)


import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document; // 추가(2)


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs // 추가(1)
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("정상적으로 이벤트를 생성하는 테스트")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("강남역 D2 스타트업 팩토리")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event")); // 추가(2)
        ;
    }

    // 이 외 테스트 코드 생략
    
}

```  
* **`@AutoConfigureRestDocs`** : 이 어노테이션을 통해 Spring REST Docs를 자동 설정 할 수 있다..  
* `.andDo(document("create-event"));` : 아래와 같이 `./target/generated-snippets/create-event/`디렉토리 내에 문서가 생성된다.  
  
---  
### 결과 (1)
테스트 코드를 실행하면 다음과 같이 문서가 생성되는 것을 확인할 수 있다.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/39fa8d85-b969-4d93-9834-5679b1ed9471)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/21f6d08e-8314-4346-ae72-6ee8c83defc9)  
위 REST Docs 파일 하나만 예로 살펴보자. 출력 값이 Formating이 안되어 보기 불편한 것을 확인할 수 있다.  
이를 Formating하려면 **`RestDocMockMvc`**를 커스마이징하면 된다. 우선, **`RestDocsMockMvcConfigurationCustomizer`**를 구현한 빈을 등록하자.  
  
---  
### RestDocsConfiguration 생성  
우선 **`RestDocsMockMvcConfigurationCustomizer`**를 빈으로 등록하기 위해 Rest Docs 환경 설정을 해줄 **`RestDocsConfiguration`** 클래스 파일을 생성해준다.  
```java
package me.hantomas.restapi.common;

import org.springframework.boot.test.autoconfigure.restdocs.RestDocsMockMvcConfigurationCustomizer;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.context.annotation.Bean;
import org.springframework.restdocs.mockmvc.MockMvcRestDocumentationConfigurer;

import static org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;

@TestConfiguration
public class RestDocsConfiguration {

    @Bean
    public RestDocsMockMvcConfigurationCustomizer restDocsMockMvcConfigurationCustomizer() {
        return configurer -> configurer.operationPreprocessors()
                .withRequestDefaults(prettyPrint())
                .withResponseDefaults(prettyPrint());
    }
}

```   
* `prettyPrint()`메소드를 통해 출력 문을 보기 좋게 formating 한다.  
* 위 코드에서는 **Lamda표현식**을 썼는데 이는 따로 블로그에 정리해보겠다.  
  
---  
### EventControllerTests 수정 (2)  
```java
// import 생략
import org.springframework.context.annotation.Import; // 추가


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class) // 추가
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("정상적으로 이벤트를 생성하는 테스트")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("강남역 D2 스타트업 팩토리")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event"));
        ;
    }

    // 이 외 테스트 코드 생략
    
}

```  
* **`@Import(RestDocsConfiguration.class)`**어노테이션을 추가하여 다른 빈 설정 파일인 `RestDocsConfigurateion.class`를 import해서 사용한다.
  
---  
### 결과 (2)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/71f2f4ac-5168-4ef0-924d-68a32c8079cc)  
  




