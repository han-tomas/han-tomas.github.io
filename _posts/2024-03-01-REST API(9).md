---
title: REST API(9) Spring REST Docs - Self - Descriptive Message ì ìš©
date: 2024-03-01 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
## Spring REST Docs ì†Œê°œ  
Spring REST Docs í”„ë¡œì íŠ¸ëŠ” Spring MVC Testë¥¼ ì‚¬ìš©í•´ì„œ ë¬¸ì„œì˜ snippet(REST APIì˜ ë¬¸ì„œ ì¡°ê°)ë“¤ì„ ìƒì„±í•  ë•Œ ìœ ìš©í•œ ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë‹¤.  
Testë¥¼ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•œ ìš”ì²­(Request)ì™€ ì‘ë‹µ(Response), ì‘ë‹µì— ì‹¤ë ¤ìˆëŠ” í—¤ë”(Header) ë“±ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•´ snippet(ë¬¸ì„œ ì¡°ê°)ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ë‚˜ì¤‘ì— ì´ snippetë“¤ì„ ëª¨ì•„ì„œ REST API documentation(HTML)ì„ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.  
ê¸°ë³¸ì ìœ¼ë¡œ Spring REST docsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Asciidoctorë¼ëŠ” íˆ´ì„ ì‚¬ìš©í•œë‹¤. ì´ Asciidoctorë¥¼ ì‚¬ìš©í•˜ë©´ plain textë¡œ ì‘ì„±í•œ ë¬¸ì„œë¥¼ Asciidocì´ë¼ëŠ” íŠ¹ë³„í•œ ë¬¸ë²•(ë§ˆí¬ë‹¤ìš´ì´ë‘ ë¹„ìŠ·í•œ)ì— ë§ì¶° snippetë“¤ì„ ë§Œë“¤ê³ , ì´ë¥¼ ì¡°í•©í•´ì„œ ì¡°í•©í•´ì„œ HTML ë¬¸ì„œë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.  
ìš°ë¦¬ê°€ MockMVCë¥¼ í†µí•´ ë§Œë“  Testë“¤ì„ REST docsì™€ ì—°ë™í•  ìˆ˜ ìˆë‹¤.  
  
---  
## Spring REST Docs ì ìš©  
ì´ì œ Spring REST Docsë¥¼ ìš°ë¦¬ì˜ APIì— ì ìš©ì‹œì¼œ ë³´ì.  
  
---
## êµ¬í˜„ Package ë° Class  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/af99aa9b-af9f-4ce3-bae4-7eebfd19e149)  
  
---  
### EventControllerTests ìˆ˜ì • (1)  
```java
// import ìƒëµ
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs; // ì¶”ê°€(1)


import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document; // ì¶”ê°€(2)


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs // ì¶”ê°€(1)
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event")); // ì¶”ê°€(2)
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* **`@AutoConfigureRestDocs`** : ì´ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ Spring REST Docsë¥¼ ìë™ ì„¤ì • í•  ìˆ˜ ìˆë‹¤..  
* `.andDo(document("create-event"));` : ì•„ë˜ì™€ ê°™ì´ `./target/generated-snippets/create-event/`ë””ë ‰í† ë¦¬ ë‚´ì— ë¬¸ì„œê°€ ìƒì„±ëœë‹¤.  
  
---  
### ê²°ê³¼ (1)
í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ì„œê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/39fa8d85-b969-4d93-9834-5679b1ed9471)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/21f6d08e-8314-4346-ae72-6ee8c83defc9)  
ìœ„ REST Docs íŒŒì¼ í•˜ë‚˜ë§Œ ì˜ˆë¡œ ì‚´í´ë³´ì. ì¶œë ¥ ê°’ì´ Formatingì´ ì•ˆë˜ì–´ ë³´ê¸° ë¶ˆí¸í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
ì´ë¥¼ Formatingí•˜ë ¤ë©´ **`RestDocMockMvc`**ë¥¼ ì»¤ìŠ¤ë§ˆì´ì§•í•˜ë©´ ëœë‹¤. ìš°ì„ , **`RestDocsMockMvcConfigurationCustomizer`**ë¥¼ êµ¬í˜„í•œ ë¹ˆì„ ë“±ë¡í•˜ì.  
  
---  
### RestDocsConfiguration ìƒì„±  
ìš°ì„  **`RestDocsMockMvcConfigurationCustomizer`**ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê¸° ìœ„í•´ Rest Docs í™˜ê²½ ì„¤ì •ì„ í•´ì¤„ **`RestDocsConfiguration`** í´ë˜ìŠ¤ íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.  
```java
package me.hantomas.restapi.common;

import org.springframework.boot.test.autoconfigure.restdocs.RestDocsMockMvcConfigurationCustomizer;
import org.springframework.boot.test.context.TestConfiguration;
import org.springframework.context.annotation.Bean;
import org.springframework.restdocs.mockmvc.MockMvcRestDocumentationConfigurer;

import static org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;

@TestConfiguration
public class RestDocsConfiguration {

    @Bean
    public RestDocsMockMvcConfigurationCustomizer restDocsMockMvcConfigurationCustomizer() {
        return configurer -> configurer.operationPreprocessors()
                .withRequestDefaults(prettyPrint())
                .withResponseDefaults(prettyPrint());
    }
}

```   
* `prettyPrint()`ë©”ì†Œë“œë¥¼ í†µí•´ ì¶œë ¥ ë¬¸ì„ ë³´ê¸° ì¢‹ê²Œ formating í•œë‹¤.  
* ìœ„ ì½”ë“œì—ì„œëŠ” **Lamdaí‘œí˜„ì‹**ì„ ì¼ëŠ”ë° ì´ëŠ” ë”°ë¡œ ë¸”ë¡œê·¸ì— ì •ë¦¬í•´ë³´ê² ë‹¤.  
  
---  
### EventControllerTests ìˆ˜ì • (2)  
```java
// import ìƒëµ
import org.springframework.context.annotation.Import; // ì¶”ê°€


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class) // ì¶”ê°€
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event"));
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* **`@Import(RestDocsConfiguration.class)`**ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ì—¬ ë‹¤ë¥¸ ë¹ˆ ì„¤ì • íŒŒì¼ì¸ `RestDocsConfigurateion.class`ë¥¼ importí•´ì„œ ì‚¬ìš©í•œë‹¤.
  
---  
### ê²°ê³¼ (2)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/71f2f4ac-5168-4ef0-924d-68a32c8079cc)  
  
---  
## Spring Rest Docs : ë§í¬, ìš”ì²­/ì‘ë‹µì˜ í•„ë“œì™€ í—¤ë” ë¬¸ì„œí™”  

> * ~~ìš”ì²­ ë³¸ë¬¸ ë¬¸ì„œí™”~~(ì™„ë£Œ)  
> * ~~ì‘ë‹µ ë³¸ë¬¸ ë¬¸ì„œí™”~~(ì™„ë£Œ)  
> * ë§í¬ ë¬¸ì„œí™”  
>     * self  
>     * query-events  
>     * update-event  
>     * profile ë§í¬ ì¶”ê°€  
> * ìš”ì²­ í—¤ë” ë¬¸ì„œí™”  
> * ìš”ì²­ í•„ë“œ ë¬¸ì„œí™”  
> * ì‘ë‹µ í—¤ë” ë¬¸ì„œí™”  
> * ì‘ë‹µ í•„ë“œ ë¬¸ì„œí™”  
  
í˜„ì¬ ìš”ì²­/ì‘ë‹µ ë³¸ë¬¸ì„ ë¬¸ì„œí™”í•˜ëŠ” ì‘ì—…ê¹Œì§€ ì™„ë£Œë˜ì—ˆë‹¤. ì´ì œ ë§í¬, ìš”ì²­/ì‘ë‹µì˜ í•„ë“œì™€ í—¤ë”ë“¤ì„ ë¬¸ì„œí™”í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ì.  
  
---  
### ë§í¬ ë¬¸ì„œí™”  
```java
// import ìƒëµ
import static org.springframework.restdocs.hypermedia.HypermediaDocumentation.linkWithRel; // ì¶”ê°€
import static org.springframework.restdocs.hypermedia.HypermediaDocumentation.links; // ì¶”ê°€


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class) // ì¶”ê°€
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event",
                        links( // ì¶”ê°€
                                linkWithRel("self").description("link to self"),
                                linkWithRel("query-events").description("link to query events"),
                                linkWithRel("update-event").description("link to update event")
                        )
                                
                ))
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* `links() + linkWithRel()` : ë§í¬ì™€ ê´€ë ¨ëœ ë¬¸ì„œì¡°ê°(`"links.adoc"`)ì„ ìƒì„±í•œë‹¤.  
  
### ê²°ê³¼  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/828a2056-209b-41d2-8c8c-62047bf1287c)  
  
---  
### ìš”ì²­/ì‘ë‹µì˜ í•„ë“œì™€ í—¤ë” ë¬¸ì„œí™”  
ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ìš”ì²­ê³¼ ì‘ë‹µì˜ í•„ë“œì™€ í—¤ë”ë¥¼ ë¬¸ì„œí™” í•  ìˆ˜ ìˆë‹¤.  
```java
// import ìƒëµ  
import static org.springframework.restdocs.headers.HeaderDocumentation.*;  
import static org.springframework.restdocs.payload.PayloadDocumentation.*;


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class) // ì¶”ê°€
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event",
                        links(
                                linkWithRel("self").description("link to self"),
                                linkWithRel("query-events").description("link to query events"),
                                linkWithRel("update-event").description("link to update event")
                        ),
                        requestHeaders( // ì¶”ê°€
                                headerWithName(HttpHeaders.ACCEPT).description("accept header"),
                                headerWithName(HttpHeaders.CONTENT_TYPE).description("content type header")
                        ),
                        requestFields( // ì¶”ê°€
                                fieldWithPath("name").description("name of new event"),
                                fieldWithPath("description").description("description of new event"),
                                fieldWithPath("beginEnrollmentDateTime").description("date time of begin of new event"),
                                fieldWithPath("closeEnrollmentDateTime").description("date time of close of new event"),
                                fieldWithPath("beginEventDateTime").description("date time of begin of new event"),
                                fieldWithPath("endEventDateTime").description("date time of end of new event"),
                                fieldWithPath("location").description("location of new event"),
                                fieldWithPath("basePrice").description("basePrice of new event"),
                                fieldWithPath("maxPrice").description("maxPrice of new event"),
                                fieldWithPath("limitOfEnrollment").description("limit of enrollment")
                        ),
                        responseHeaders( // ì¶”ê°€
                                headerWithName(HttpHeaders.LOCATION).description("Location header"),
                                headerWithName(HttpHeaders.CONTENT_TYPE).description("Content type")
                        ),
                        responseFields( // ì¶”ê°€
                                fieldWithPath("id").description("identifier of new event"),
                                fieldWithPath("name").description("name of new event"),
                                fieldWithPath("description").description("description of new event"),
                                fieldWithPath("beginEnrollmentDateTime").description("date time of begin of new event"),
                                fieldWithPath("closeEnrollmentDateTime").description("date time of close of new event"),
                                fieldWithPath("beginEventDateTime").description("date time of begin of new event"),
                                fieldWithPath("endEventDateTime").description("date time of end of new event"),
                                fieldWithPath("location").description("location of new event"),
                                fieldWithPath("basePrice").description("basePrice of new event"),
                                fieldWithPath("maxPrice").description("maxPrice of new event"),
                                fieldWithPath("limitOfEnrollment").description("limit of enrollment"),
                                fieldWithPath("free").description("it tells if this event is free or not"),
                                fieldWithPath("offline").description("it tells if this event is offline event or not"),
                                fieldWithPath("eventStatus").description("event status")
                        )
                ))
        ;
    }

    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
    
}

```  
* `requestHeaders() + headerWithName()` : ìš”ì²­ í—¤ë”ì™€ ê´€ë ¨ëœ ë¬¸ì„œì¡°ê°(`"request-headers.adoc"`)ì„ ìƒì„±í•œë‹¤.  
* `requestFields() + fieldWithPath()` : ìš”ì²­ í•„ë“œì™€ ê´€ë ¨ëœ ë¬¸ì„œì¡°ê°(`"request-fields.adoc"`)ì„ ìƒì„±í•œë‹¤.  
* `responseHedaers() + headerWithName()` : ì‘ë‹µ í—¤ë”ì™€ ê´€ë ¨ëœ ë¬¸ì„œì¡°ê°(`"response-headers.adoc"`)ì„ ìƒì„±í•œë‹¤.  
* `responseFields() + fieldWithPath()` : ì‘ë‹µ í•„ë“œì™€ ê´€ë ¨ëœ ë¬¸ì„œì¡°ê°(`"response-fields.adoc"`)ì„ ìƒì„±í•œë‹¤.  
  
---  
### ê²°ê³¼ (ì‹¤íŒ¨)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3e1bb8ef-5b1c-442c-90e8-5dce9ff3462b)  
ìš°ë¦¬ëŠ” ë§í¬ì™€ ê´€ë ¨ëœ ì •ë³´ë“¤ì€ `links() + linkWithRel()`ë¥¼ í†µí•´ ë¬¸ì„œí™”ë¥¼ í•´ì¤¬ë‹¤. 
í•˜ì§€ë§Œ ì˜¤ë¥˜ì—ì„œëŠ” ê·¸ë ‡ì§€ ì•Šë‹¤ê³  í•œë‹¤. ì˜¤ë¥˜ì—ì„œ ë¬¸ì„œí™” í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ë§í¬ëŠ” **ì‘ë‹µ ë³¸ë¬¸(response)ì— ë‹´ê²¨ì ¸ ìˆëŠ”** ë§í¬ ì •ë³´ë“¤ì´ë‹¤. ë”°ë¼ì„œ, ì‘ë‹µ ë³¸ë¬¸ì˜ ë§í¬ ì •ë³´ ê²€ì¦ì„ í”¼í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” ì¼ë¶€ ì‘ë‹µë§Œ ë¬¸ì„œí™” í•˜ëŠ” `relexedResponseFields() + fieldWithPath()`ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.  
  
> Relaxed ì ‘ë‘ì–´
> * ì¥ì : ë¬¸ì„œ ì¼ë¶€ë¶„ë§Œ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤.
> * ë‹¨ì : ì •í™•í•œ ë¬¸ì„œë¥¼ ìƒì„±í•˜ì§€ ëª»í•œë‹¤.  
  
ì´ëŸ¬í•œ ë‹¨ì ì´ ìˆê¸° ë•Œë¬¸ì—, ì‘ë‹µ ë³¸ë¬¸ì—ì„œë„ ë§í¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹¤ ì •ì˜í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.  
  
---  
### ê²°ê³¼ (relaxedResponseFields() - ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/130c3ec2-9d86-42e8-879a-778d88c1c8e9)
  
---    
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3182075d-42d5-46c9-b15e-760c02ac25a7)  
  
---  
## Spring REST Docs ë¬¸ì„œ ë¹Œë“œ  
ì´ì œ ìš°ë¦¬ì˜ REST APIì— ëŒ€í•œ ë¬¸ì„œë¥¼ ë¹Œë“œí•´ë³´ì.  
### pom.xml
ìš°ì„  pom.xmlì— ë©”ì´ë¸ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì •í•˜ì.  
```html
<plugin>
    <groupId>org.asciidoctor</groupId>
    <artifactId>asciidoctor-maven-plugin</artifactId>
    <version>1.5.8</version>
    <executions>
        <execution>
            <id>generate-docs</id>
            <phase>prepare-package</phase>
            <goals>
                <goal>process-asciidoc</goal>
            </goals>
            <configuration>
                <backend>html</backend>
                <doctype>book</doctype>
            </configuration>
        </execution>
    </executions>
    <dependencies>
        <dependency>
            <groupId>org.springframework.restdocs</groupId>
            <artifactId>spring-restdocs-asciidoctor</artifactId>
            <version>${spring-restdocs.version}</version>
        </dependency>
    </dependencies>
</plugin>
<plugin>
    <artifactId>maven-resources-plugin</artifactId>
    <version>2.7</version>
    <executions>
        <execution>
            <id>copy-resources</id>
            <phase>prepare-package</phase>
            <goals>
                <goal>copy-resources</goal>
            </goals>
            <configuration>
                <outputDirectory>
                    ${project.build.outputDirectory}/static/docs
                </outputDirectory>
                <resources>
                    <resource>
                        <directory>
                            ${project.build.directory}/generated-docs
                        </directory>
                    </resource>
                </resources>
            </configuration>
        </execution>
    </executions>
</plugin>
```  
* `asciidoctor-maven-plugin`ìœ¼ë¡œ `generated-docs`ì— `index.html`ì„ ìƒì„±í•œë‹¤.  
    * `prepare-package`ë¼ëŠ” phaseê°€ asciidocì„ ì²˜ë¦¬í•œë‹¤.
        * `process-asciidoc` src.main.asciidoc ë””ë ‰í† ë¦¬ ì•ˆì— ë“¤ì–´ìˆëŠ” ëª¨ë“  asciidocë¬¸ì„œë¥¼ htmlë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.  
* `maven-resources-plugin`ì€ `static.docs`ì— ìœ„ì˜ `index.html`ë¥¼ ì˜®ê²¨ì¤€ë‹¤.
    * `copy-resources`ê°€ `${project.build.outputDirectory}/static/docs`ì— `${project.build.directory}/generated-docs`ì— ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ copyí•œë‹¤.  
* ìƒì„±í›„ ë³µì‚¬ë¥¼ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ìœ„ **í”ŒëŸ¬ê·¸ì¸ ì„ ì–¸ ìˆœì„œê°€ ì¤‘ìš”**í•˜ë‹¤.
* ìœ„ ê³¼ì •ë“¤ì€ ì†ŒìŠ¤ ë””ë ‰í† ë¦¬ì—ì„œ ì¼ì–´ë‚œ ê²ƒì´ ì•„ë‹Œ ë¹Œë“œ ë””ë ‰í† ë¦¬ ë‚´ì—ì„œ ì¼ì–´ë‚œ ê²ƒì„ì„ ê¸°ì–µí•˜ì.
    * ë¹Œë“œ = ì†ŒìŠ¤ì½”ë“œì—ì„œ ì»´íŒŒì¼ ëœ íŒŒì¼ë“¤ì„ ì ì ˆí•œ classpath ë°‘ìœ¼ë¡œ ë„£ì–´ì£¼ëŠ” í–‰ìœ„

---  
### ë¬¸ì„œ íŒŒì¼ ìƒì„±  
ì•„ë˜ì™€ ê°™ì´ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ì–´ [index.adoc](https://gitlab.com/whiteship/natural/-/blob/master/src/main/asciidoc/index.adoc?ref_type=heads) íŒŒì¼ì„ ë§Œë“¤ì–´ ì¤€ë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/334cb528-9650-4a84-88a6-a400f0b35229)  
  
---  
### Maven packaging  
* Mavenì˜ Lifecycleì¤‘ packageë¥¼ ì‹¤í–‰ì‹œì¼œì£¼ë©´ ëœë‹¤. ê·¸ëŸ¼ ë‹¤ìŒê³¼ ê°™ì€ ê²½ë¡œì— íŒŒì¼ì´ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/348a2bb7-30df-4f4a-b6e9-098fffaff33d)  
* `target` ë””ë ‰í† ë¦¬ë¥¼ ì‚´í´ë³´ë©´ `static` ë°‘ì— `docs` ì•ˆì— íŒŒì¼ì´ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>ì´ëŠ” ì‹¤ì œ ì›¹ì„œë²„ë¥¼ ë„ìš°ë©´, `http://localhost:8080/docs/index.html`ì„ í†µí•´ì„œë„ ë¬¸ì„œì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì¤€ë‹¤.  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/97e9a18e-f688-4649-bed3-8bf5fd6bba68)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/91e0903e-482d-43e3-8b5a-449a73186d00)  
  
---  
## profile ë§í¬ ì¶”ê°€  
ë³¸ë¬¸ì— ëŒ€í•œ ë¬¸ì„œ(docs) ë§í¬ì¸ profile ë§í¬ë¥¼ ì¶”ê°€í•´ë³´ì.  

### EventController  
```java
// import ìƒëµ
import org.springframework.hateoas.Link;  


@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    private final EventValidator eventValidator;

    public EventController(EventRepository eventRepository, ModelMapper modelMapper, EventValidator eventValidator) {
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper;
        this.eventValidator = eventValidator;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){

        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        eventValidator.validate(eventDto, errors);
        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        Event event = modelMapper.map(eventDto, Event.class);
        event.update();
        Event newEvent = this.eventRepository.save(event);

        ControllerLinkBuilder selfLinkBuilder = linkTo(EventController.class).slash(newEvent.getId());
        URI createdUri = selfLinkBuilder.toUri();
        EventResource eventResource = new EventResource(newEvent);
        eventResource.add(linkTo(EventController.class).withRel("query-events"));
        eventResource.add(selfLinkBuilder.withRel("update-event"));
        eventResource.add(new Link("/docs/index.html#resources-events-create").withRel("profile")); // ì¶”ê°€
        return ResponseEntity.created(createdUri).body(eventResource);
    }
}

```   
  
---  
### EventControllerTests  
```java
// import ìƒëµ  
@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
@AutoConfigureRestDocs
@Import(RestDocsConfiguration.class)
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception{
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024,02,19,14,21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024,02,20,14,21))
                .beginEventDateTime(LocalDateTime.of(2024,02,21,14,21))
                .endEventDateTime(LocalDateTime.of(2024,02,22,14,21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists())
                .andExpect(jsonPath("_links.query-events").exists())
                .andExpect(jsonPath("_links.update-event").exists())
                .andDo(document("create-event",
                        links(
                                linkWithRel("self").description("link to self"),
                                linkWithRel("query-events").description("link to query events"),
                                linkWithRel("update-event").description("link to update event"),
                                linkWithRel("profile").description("link to profile") // ì¶”ê°€
                        ),
                        requestHeaders(
                                headerWithName(HttpHeaders.ACCEPT).description("accept header"),
                                headerWithName(HttpHeaders.CONTENT_TYPE).description("content type header")
                        ),
                        requestFields(
                                fieldWithPath("name").description("name of new event"),
                                fieldWithPath("description").description("description of new event"),
                                fieldWithPath("beginEnrollmentDateTime").description("date time of begin of new event"),
                                fieldWithPath("closeEnrollmentDateTime").description("date time of close of new event"),
                                fieldWithPath("beginEventDateTime").description("date time of begin of new event"),
                                fieldWithPath("endEventDateTime").description("date time of end of new event"),
                                fieldWithPath("location").description("location of new event"),
                                fieldWithPath("basePrice").description("basePrice of new event"),
                                fieldWithPath("maxPrice").description("maxPrice of new event"),
                                fieldWithPath("limitOfEnrollment").description("limit of enrollment")
                        ),
                        responseHeaders(
                                headerWithName(HttpHeaders.LOCATION).description("Location header"),
                                headerWithName(HttpHeaders.CONTENT_TYPE).description("Content type")
                        ),
                        responseFields(
                                fieldWithPath("id").description("identifier of new event"),
                                fieldWithPath("name").description("name of new event"),
                                fieldWithPath("description").description("description of new event"),
                                fieldWithPath("beginEnrollmentDateTime").description("date time of begin of new event"),
                                fieldWithPath("closeEnrollmentDateTime").description("date time of close of new event"),
                                fieldWithPath("beginEventDateTime").description("date time of begin of new event"),
                                fieldWithPath("endEventDateTime").description("date time of end of new event"),
                                fieldWithPath("location").description("location of new event"),
                                fieldWithPath("basePrice").description("basePrice of new event"),
                                fieldWithPath("maxPrice").description("maxPrice of new event"),
                                fieldWithPath("limitOfEnrollment").description("limit of enrollment"),
                                fieldWithPath("free").description("it tells if this event is free or not"),
                                fieldWithPath("offline").description("it tells if this event is offline event or not"),
                                fieldWithPath("eventStatus").description("event status"),
                                fieldWithPath("_links.self.href").description("link to self"),
                                fieldWithPath("_links.query-events.href").description("link to query events"),
                                fieldWithPath("_links.update-event.href").description("link to update event"),
                                fieldWithPath("_links.profile.href").description("link to profile") // ì¶”ê°€
                        )
                ))
        ;
    }
}
```  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/846ed510-d973-4801-9d4f-decb7c6b21fd)  







 





