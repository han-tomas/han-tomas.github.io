---
title: REST API(8) HATEOAS ì ìš©
date: 2024-02-29 00:00:00 +0900
categories: [âš™ï¸Back-End, ğŸƒSpring]
tags: [Spring,
RESTful,
REST,
API,
REST API,
RESTful API,
HATEOAS,
Self-descriptive,
]     
---  
  
## Spring HATEOAS ì†Œê°œ  
Spring HATEOAS ë€ **HATEOAS** ë¥¼ ë§Œì¡±í•˜ëŠ” REST representationì„ ì œê³µí•˜ëŠ” APIë¥¼ ë§Œë“¤ ë•Œ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íˆ´ì„ ì œê³µí•´ ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. HATEOASë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ê°€ **í•˜ì´í¼ë¯¸ë””ì–´(Link)**ë¥¼ í†µí•´ ë™ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìƒí˜¸ ì‘ìš©í•œë‹¤.  
  
### HATEOASì˜ ì˜ˆì‹œì™€ ì„¤ëª…  
  
ì˜ˆë¥¼ ì´ìš©í•˜ì—¬ ì´í•´í•´ë³´ì.  
  
```html
GET /accounts/12345 HTTP/1.1
Host: bank.example.com
```  
  
ì´ **`GET`**ìš”ì²­ì€ `12345`ë¼ëŠ” ê³„ì • ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì™€ì„œ JSONí‘œí˜„ìœ¼ë¡œ ì •ë³´ë¥¼ ìš”ì²­í•œë‹¤.  
ì´ì— ëŒ€í•œ ì‘ë‹µì€ ë‹¤ìŒê³¼ ê°™ë‹¤.  
```html
HTTP/1.1 200 OK

{
    "account": {
        "account_number": 12345,
        "balance": {
            "currency": "usd",
            "value": 100.00
        },
        "links": {
            "deposits": "/accounts/12345/deposits",
            "withdrawals": "/accounts/12345/withdrawals",
            "transfers": "/accounts/12345/transfers",
            "close-requests": "/accounts/12345/close-requests"
        }
    }
}
```  
ì´ ì‘ë‹µì—ëŠ”  `deposits(ì…ê¸ˆ)`, `withdrawals(ì¶œê¸ˆ)`, `transfers(ì´ì²´)`, `close-requests(ìš”ì²­ ë‹«ê¸°/ê³„ì¢Œ ë‹«ê¸°)`ì™€ ê°™ì€ í›„ì† ë§í¬ë“¤ì„ í¬í•¨í•˜ê³  ìˆê³ , ì´ëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ í´ë¼ì´ì–¸íŠ¸ ê°„ì— ì–´ë– í•œ ìƒí˜¸ì‘ìš©ì„ í•  ìˆ˜ ìˆëŠ”ì§€ ë¦´ë ˆì´ì…˜**ì„ ë‚˜íƒ€ë‚¸ë‹¤.  
  
```html
HTTP / 1.1  200  OK
 
{ 
    "account": { 
        "account_number": 12345, 
        "balance": { 
            "currency": "usd", 
            "value": -25.00 
        }, 
        "links": { 
            "deposits": "/accounts /12345/ì˜ˆê¸ˆ" 
        } 
    } 
}
```  
ìœ„ ì •ë³´ì™€ ê°™ì´, ê³„ì¢Œì— ìˆëŠ” ê¸ˆì•¡ì´ ë§ˆì´ë„ˆìŠ¤(-)ì¸ ê²½ìš°ì—ëŠ” `deposits(ì…ê¸ˆ)`ë§Œ ê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„í•´ì•¼í•œë‹¤.  
ì¦‰, HATEOAS ëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœì˜ ë³€í™”ì— ë”°ë¼ ë§í¬ì˜ ì •ë³´ê°€ ë°”ë€Œì–´ì•¼ í•œë‹¤**.  
  
---  
## Spring HATEOASì˜ ê¸°ëŠ¥  
Spring HATEOAS ê°€ ì œê³µí•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ë‘ ê°€ì§€ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ë§í¬ ë§Œë“œëŠ” ê¸°ëŠ¥
    * ë¬¸ìì—´ ê°€ì§€ê³  ë§Œë“¤ê¸°
    * ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë©”ì†Œë“œë¡œ ë§Œë“¤ê¸°   
2. ë¦¬ì†ŒìŠ¤ ë§Œë“œëŠ” ê¸°ëŠ¥
    * ë¦¬ì†ŒìŠ¤ = ë°ì´í„°(ì›ë˜ ì „ë‹¬í•´ ì£¼ê³ ì í•˜ëŠ” ì‘ë‹µ ë³¸ë¬¸) + ë§í¬  
  
---  
## Event ìƒì„± APIì— ë“¤ì–´ê°€ì•¼í•˜ëŠ” ë§í¬ ì •ë³´  
í¬ê²Œ **`HREF`** ì™€ **`REL`** ì •ë³´ê°€ ë“¤ì–´ê°€ì•¼ í•˜ëŠ”ë°, ìì„¸íˆ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.  
* **`HREF`** : URI ë‚˜ URL ì„¤ì •
* **`REL`** : í˜„ì¬ ë¦¬ì†ŒìŠ¤ì™€ì˜ ê´€ê³„
    * self : ìê¸° ìì‹ ì— ëŒ€í•œ URL
    * profile : ì‘ë‹µ ë³¸ë¬¸ì— ëŒ€í•œ ë¬¸ì„œ(docs)ë¡œ ë§í¬
    * update-event : ì´ë²¤íŠ¸ ìˆ˜ì • ë§í¬
    * query-events : ì´ë²¤íŠ¸ ì¡°íšŒ ë§í¬  
  
---  
## Event ìƒì„± APIì— Spring HATEOAS ì ìš©  
ìš°ë¦¬ê°€ ë§Œë“  Event ìƒì„± APIì— Spring HATEOASë¥¼ ì ìš©í•´ ë³´ì.

### EventControllerTests  
ìš°ë¦¬ëŠ” ì´ë²¤íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„± ë˜ì—ˆì„ ë•Œ ë§í¬ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ì•¼í•œë‹¤.  
```java
//import ìƒëµ  


@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class EventControllerTests {
    @Autowired
    MockMvc mockMvc;
    @Autowired
    ObjectMapper objectMapper;

    @Test
    @TestDescription("ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸")
    public void createEvent() throws Exception {
        EventDto event = EventDto.builder()
                .name("Spring")
                .description("REST API Development With Spring")
                .beginEnrollmentDateTime(LocalDateTime.of(2024, 02, 19, 14, 21))
                .closeEnrollmentDateTime(LocalDateTime.of(2024, 02, 20, 14, 21))
                .beginEventDateTime(LocalDateTime.of(2024, 02, 21, 14, 21))
                .endEventDateTime(LocalDateTime.of(2024, 02, 22, 14, 21))
                .basePrice(100)
                .maxPrice(200)
                .limitOfEnrollment(100)
                .location("ê°•ë‚¨ì—­ D2 ìŠ¤íƒ€íŠ¸ì—… íŒ©í† ë¦¬")
                .build();

        mockMvc.perform(post("/api/events/")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)
                        .accept(MediaTypes.HAL_JSON)
                        .content(objectMapper.writeValueAsString(event))
                )
                .andDo(print())
                .andExpect(status().isCreated())
                .andExpect(jsonPath("id").exists())
                .andExpect(header().exists(HttpHeaders.LOCATION))
                .andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON_UTF8_VALUE))
                .andExpect(jsonPath("free").value(false))
                .andExpect(jsonPath("offline").value(true))
                .andExpect(jsonPath("eventStatus").value(EventStatus.DRAFT.name()))
                .andExpect(jsonPath("_links.self").exists()) // self link
                .andExpect(jsonPath("_links.query-events").exists()) // ì´ë²¤íŠ¸ ì¡°íšŒ ë§í¬
                .andExpect(jsonPath("_links.update-event").exists()) // ì´ë²¤íŠ¸ ìˆ˜ì • ë§í¬
        ;
    }
    // ì´ ì™¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ
}  
```  
  
---  
### EventResource í´ë˜ìŠ¤ ìƒì„± (1) ResourceSupport ìƒì†
ì›ë˜ ì „ë‹¬í•´ì£¼ê³ ì í•˜ëŠ” ìš”ì²­í•œ ê°ì²´ì— ëŒ€í•œ ì‘ë‹µ, ì¦‰ **ë°ì´í„°**ì— **í•˜ì´í¼ë¯¸ë””ì–´(link)**ë¥¼ ì¶”ê°€í•´ì£¼ê¸° ìœ„í•´ì„œëŠ” **`ResourceSupport`**ë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤. ì´ë¥¼ **`EventResource`**ë¼ëŠ” ì´ë¦„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì£¼ê² ë‹¤.  
```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.annotation.JsonUnwrapped;
import org.springframework.hateoas.ResourceSupport;

public class EventResource extends ResourceSupport {
    private Event event;

    public EventResource(Event event){
        this.event = event;
    }

    public Event getEvent() {
        return event;
    }
}

```  
  
---  
### EventController  
```java
package me.hantomas.restapi.events;

import org.modelmapper.ModelMapper;
import org.springframework.hateoas.MediaTypes;
import org.springframework.hateoas.mvc.ControllerLinkBuilder;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.validation.Errors;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.validation.Valid;
import java.net.URI;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

@Controller
@RequestMapping(value = "/api/events", produces = MediaTypes.HAL_JSON_UTF8_VALUE)
public class EventController {
    private final EventRepository eventRepository;

    private final ModelMapper modelMapper;

    private final EventValidator eventValidator;

    public EventController(EventRepository eventRepository, ModelMapper modelMapper, EventValidator eventValidator) {
        this.eventRepository = eventRepository;
        this.modelMapper = modelMapper;
        this.eventValidator = eventValidator;
    }
    @PostMapping
    public ResponseEntity createEvent(@RequestBody @Valid EventDto eventDto, Errors errors){

        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        eventValidator.validate(eventDto, errors);
        if (errors.hasErrors()){
            return ResponseEntity.badRequest().body(errors);
        }

        Event event = modelMapper.map(eventDto, Event.class);
        event.update();
        Event newEvent = this.eventRepository.save(event);

        ControllerLinkBuilder selfLinkBuilder = linkTo(EventController.class).slash(newEvent.getId()); // (1)
        URI createdUri = selfLinkBuilder.toUri();
        EventResource eventResource = new EventResource(newEvent); // (2)
        eventResource.add(linkTo(EventController.class).withRel("query-events")); // "query-events"  
        eventResource.add(selfLinkBuilder.withSelfRel()); //"self"
        eventResource.add(selfLinkBuilder.withRel("update-event")); // "update-event" 
        return ResponseEntity.created(createdUri).body(eventResource);
    }
}

```  
* `(1)` : ê³µí†µìœ¼ë¡œ ì“°ì¼ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§ í•´ì¤€ë‹¤. "/api/events/{id}"  
* `(2)` : **`EventResource`**ë¥¼ í˜¸ì¶œí•˜ê³  `newEvent`ê°ì²´ë¥¼ ë‹´ì•„ì¤€ë‹¤.  
* `"query-events"`,`"self"`,`"update-event"` ê´€ê³„(REL)ì˜ ë§í¬ë“¤ì„ ì¶”ê°€í•´ì¤€ë‹¤.  
  
---  
### ê²°ê³¼(ì‹¤íŒ¨)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/114155d3-d810-4bd9-bc6d-beb8458a0593)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3a82f18e-351d-4447-8ab7-4648e85f3ba7)  
ë§í¬ë“¤ì´ ì˜ ì¶”ê°€ë˜ì–´ì„œ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆì§€ë§Œ, `id`ê°’ì„ ì°¾ì§€ ëª»í–ˆë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.  
ê·¸ ì´ìœ ëŠ” ì´ë ‡ë‹¤.  
ìš°ë¦¬ëŠ” **`Controller`**ì—ì„œ  **`EventResource`**ì˜ ê°ì²´ë¥¼ ë¦¬í„´í–ˆê³ , ì´ëŠ” **`ObjectMapper`**ê°€ **`BeanSerializer`**ë¥¼ ì´ìš©í•´ Serializationí•œë‹¤. **`BeanSerializer`**ëŠ” **`EventResource`**ì˜ **`Event`**ê°ì²´ì¸ `event`ë¥¼  ê¸°ë³¸ í•„ë“œë¡œ ì‚¬ìš©í•œë‹¤. ì´ **`Event`** ê°ì²´ëŠ” `id`, `name`, `description`, ... ë“±ì˜ í•„ë“œë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê°ì²´ì´ê¸° ë•Œë¬¸ì—, ìœ„ì™€ ê°™ì´ `event`ë¼ëŠ” ì´ë¦„ ì•„ë˜ì— ê·¸ í•„ë“œë“¤ì´ í‘œì‹œë˜ê³ , ê·¸ë˜ì„œ id ê°’ì„ ì°¾ì§€ ëª»í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.  

### EventResource ìˆ˜ì •  
```java
package me.hantomas.restapi.events;

import com.fasterxml.jackson.annotation.JsonUnwrapped;
import org.springframework.hateoas.ResourceSupport;

public class EventResource extends ResourceSupport {
    @JsonUnwrapped
    private Event event;

    public EventResource(Event event){
        this.event = event;
    }

    public Event getEvent() {
        return event;
    }
}

```   
ì´ í•´ê²°ë²•ì€ ê°„ë‹¨í•˜ë‹¤. `event`ëŒ€ì‹ ì—  **`Event`**ì— ìˆëŠ” ëª¨ë“  í•„ë“œë“¤ì„ ì§ì ‘ ì„ ì–¸í•˜ì—¬ ì£¼ì…í•˜ê³  getterë¡œ êº¼ë‚´ì£¼ë©´ ëœë‹¤. í•˜ì§€ë§Œ ê·¸ë ‡ê²Œ ë˜ë©´ ì½”ë“œëŠ” êµ‰ì¥íˆ ë³µì¡í•˜ê³  ê¸¸ì–´ì§ˆ ê²ƒì´ë‹¤.  
ë‹¤ë¥¸ ê°„ë‹¨í•œ ë°©ë²•ì€ **`@JsonUnwrapped`**ì–´ë…¸í…Œì´ì…˜ë§Œ ì¶”ê°€í•´ ì£¼ë©´ ëœë‹¤. ê·¸ëŸ¬ë©´ `event`ë¡œ Wrapping ë˜ì–´ìˆëŠ” í•„ë“œë“¤ì„ êº¼ë‚´ì¤€ë‹¤.  
  
---  
### ê²°ê³¼ (ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/ef0b0201-7ea2-498f-b80d-bafa5c3c0473)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/f1b16dfd-99ff-456d-8d84-1a1d15bd71a3)  
`event`ê°€ Unwrapped ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.  
  
---  
### EventResource í´ë˜ìŠ¤ (2) Resource ìƒì†
**`ResourceSupport`**ë¼ëŠ” í´ë˜ìŠ¤ í•˜ìœ„ì˜ **`Resource<T>`**í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ë°©ë²•ì´ë‹¤.  
**`Resource<T>`**ëŠ” `getter`ì— **`@JsonUnwrapped`**ê°€ ë¶™ì–´ ìˆë‹¤. ë”°ë¼ì„œ ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ëª…ì‹œì ìœ¼ë¡œ Unwrappedí•˜ì§€ ì•Šì•„ë„ ëœë‹¤.   
```java
package me.hantomas.restapi.events;

import org.springframework.hateoas.Link;
import org.springframework.hateoas.Resource;

import static org.springframework.hateoas.mvc.ControllerLinkBuilder.linkTo;

public class EventResource extends Resource<Event> {

    public EventResource(Event event, Link... links) {
        super(event, links);
        //add(new Link("http://localhost:8080/api/events/"+ event.getId())); // TypeSafeí•˜ì§€ ì•Šë‹¤.
        add(linkTo(EventController.class).slash(event.getId()).withSelfRel());
    }
}

```  
* `"self"`ë§í¬ì˜ ê²½ìš° ë¦¬ì†ŒìŠ¤ë§ˆë‹¤ ìˆê¸° ë•Œë¬¸ì—, ìœ„ ì²˜ëŸ¼ **`EventResource`**ì— ì¶”ê°€í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.   
  
---  
### ê²°ê³¼(ì„±ê³µ)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/1ef6d89f-7c1c-4037-8fb0-d7fa5c3bbb4b)  
![image](https://github.com/han-tomas/han-tomas.github.io/assets/124488773/3593110b-ccbc-4c04-b1e7-dbe590d715a7)  
  
---  
## ì¶”ê°€  
**`HATEOAS v1.0`** ì´í›„ ë¶€í„°ëŠ” ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆë‹¤ê³  í•œë‹¤.  
  
|ë³€ê²½ ì „|ë³€ê²½ í›„|  
|:---:|:---:|  
|ResourceSupport|RepresentationModel|  
|Resource|EntityModel|  
|Resources|CollectionModel|  
|PagedResources|PagedModel|  
|ResourceAssembler|RepresentationModelAssembler|  
  
